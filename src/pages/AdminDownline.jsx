// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState, useMemo } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // import { motion } from "framer-motion";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // Recursive tree renderer
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // function TreeNode({ node }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const hasCompletedChildren =
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     Array.isArray(node.children) &&
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     node.children.some((c) => c.paymentStatus === "Completed");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (node.paymentStatus !== "Completed" && !hasCompletedChildren) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="flex flex-col items-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Node Card */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       <motion.div
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         className={`rounded-xl shadow-md px-4 py-3 mb-4 text-center w-44 ${
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           node.paymentStatus === "Completed"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             ? "bg-green-100 border border-green-400"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             : "bg-orange-100 border border-orange-400"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         }`}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         initial={{ scale: 0.8, opacity: 0 }}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         animate={{ scale: 1, opacity: 1 }}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="font-semibold text-gray-800">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="text-xs text-gray-600">Level: {node.level ?? "-"}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="text-xs text-gray-500">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           {node.paymentStatus === "Completed" ? "‚úÖ Paid" : "‚è≥ Pending"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       </motion.div>

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Children */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {Array.isArray(node.children) && node.children.length > 0 && (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="flex gap-8 justify-center relative">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <div className="absolute top-0 left-1/2 w-px h-6 bg-gray-400"></div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           {node.children.map((child, i) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <div key={i} className="flex flex-col items-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <div className="w-px h-6 bg-gray-400"></div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <TreeNode node={child} />
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // Flatten helpers
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // function flattenNode(node, acc) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node) return acc;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const hasCompletedChildren =
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     Array.isArray(node.children) &&
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     node.children.some((c) => c.paymentStatus === "Completed");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (node.paymentStatus !== "Completed" && !hasCompletedChildren) return acc;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   acc.push(node);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (Array.isArray(node.children)) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     node.children.forEach((c) => flattenNode(c, acc));
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return acc;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // function flattenForest(forest) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const out = [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   (forest || []).forEach((root) => flattenNode(root, out));
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return out;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [tree, setTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [downline, setDownline] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [error, setError] = useState("");
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [viewMode, setViewMode] = useState("tree");
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [depth, setDepth] = useState(3);

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const fetchData = async () => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setError("");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth });
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       if (!res.success)
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         throw new Error(res.message || "Failed to fetch downline");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       const forest = res.data.tree || [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setTree(forest);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline(flattenForest(forest));
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setError(err.message || "Failed to load downline data");
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setTree([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   }, [depth]); // ‚úÖ fixed dependency warning

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const totals = useMemo(
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     () => ({
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       nodes: downline.length,
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       roots: tree.length,
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     }),
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     [downline.length, tree.length]
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="max-w-6xl mx-auto p-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Header */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="flex justify-between items-center mb-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <h2 className="text-2xl font-bold">üìä Downline Network</h2>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="flex gap-3">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             className="px-4 py-2 border rounded-lg bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             onClick={() => setViewMode(viewMode === "tree" ? "table" : "tree")}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             {viewMode === "tree" ? "Show Table View" : "Show Tree View"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             className="px-4 py-2 border rounded-lg bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             onClick={fetchData}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <select
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             className="border rounded-lg px-3 py-2"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             value={depth}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             onChange={(e) => setDepth(parseInt(e.target.value, 10))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             {[...Array(10)].map((_, i) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <option key={i + 1} value={i + 1}>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 {i + 1} Level
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               </option>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </select>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Summary */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {!loading && !error && (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="mb-4 text-sm text-gray-500">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           Roots: {totals.roots} ‚Ä¢ Total nodes: {totals.nodes} ‚Ä¢ Depth: {depth}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Content */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div>üîÑ Loading...</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       ) : error ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="text-red-500">‚ùå {error}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       ) : viewMode === "tree" ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="flex justify-center overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           {Array.isArray(tree) && tree.length > 0 ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             tree.map((root, i) => <TreeNode key={i} node={root} />)
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <div>No tree data available</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <table className="w-full border-collapse text-sm shadow rounded-lg">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2 text-left">User ID</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Level</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Leg</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               {downline.map((u, i) => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 const level = u.level ?? u.depth ?? "-";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   <tr
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     key={i}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     className="hover:bg-gray-50 transition-colors duration-150"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2">{u.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2 text-center">{level}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       className={`border px-4 py-2 text-center font-semibold ${
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                         u.paymentStatus === "Completed"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                           ? "text-green-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                           : "text-orange-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       }`}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       {u.paymentStatus}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       {u.parentId || "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       {u.leg || "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               })}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // src/components/AdminDownline.jsx
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // ‚úÖ Recursive Tree Node
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // const TreeNode = ({ node }) => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Child nodes
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const children = (node.children || [])
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     .map((child) => <TreeNode key={child._id} node={child} />)
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     .filter(Boolean);

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Show only if this node OR its children have completed payment
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const hasCompletedChildren = children.length > 0;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (node.paymentStatus !== "Completed" && !hasCompletedChildren) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     <li>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="p-2 border rounded bg-gray-50 shadow-sm">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <p className="font-semibold">{node.name}</p>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <p className="text-sm text-gray-600">UserID: {node.userId}</p>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <p className="text-sm text-gray-600">Level: {node.level ?? node.depth ?? "-"}</p>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <p className="text-sm text-gray-600">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           Status:{" "}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <span
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             className={
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               node.paymentStatus === "Completed" ? "text-green-600" : "text-red-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             {node.paymentStatus}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </span>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </p>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {children.length > 0 && <ul className="ml-6 mt-2 space-y-2">{children}</ul>}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     </li>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // ‚úÖ Flatten tree into table rows
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // const flattenTree = (node, depth = 0) => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node) return [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const children = node.children || [];

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Flatten children first
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const childRows = children.flatMap((child) => flattenTree(child, depth + 1));

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Include node only if it's paid or has paid children
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const hasCompletedChildren = childRows.length > 0;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (node.paymentStatus !== "Completed" && !hasCompletedChildren) return childRows;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return [
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       ...node,
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       depth,
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     },
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     ...childRows,
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   ];
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // const AdminDownline = ({ rootUserId }) => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [treeData, setTreeData] = useState(null);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [flatData, setFlatData] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     const fetchTree = async () => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         const res = await adminAPI.getDownlineStructure({ rootUserId, depth: 3 });
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         if (res.success && res.data?.tree) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           const tree = Array.isArray(res.data.tree) ? res.data.tree : [res.data.tree];
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           setTreeData(tree);

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           // ‚úÖ Flatten tree for table view
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           const rows = tree.flatMap((n) => flattenTree(n));
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           setFlatData(rows);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         console.error("‚ùå Downline fetch error:", err);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     if (rootUserId) fetchTree();
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   }, [rootUserId]);

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (loading) return <p>Loading downline...</p>;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-4 space-y-8">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Tree View */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <h2 className="text-lg font-bold mb-2">Downline Tree</h2>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         {treeData && treeData.length > 0 ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <ul className="space-y-2">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             {treeData.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <TreeNode key={node._id} node={node} />
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </ul>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <p>No downline found.</p>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Table View */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <h2 className="text-lg font-bold mb-2">Downline Table</h2>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <table className="w-full border-collapse border">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <thead>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <tr className="bg-gray-200">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <th className="border p-2">Name</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <th className="border p-2">UserID</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <th className="border p-2">Level</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <th className="border p-2">Depth</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <th className="border p-2">Payment Status</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </thead>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             {flatData.map((row) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <tr key={row._id}>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border p-2">{row.name}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border p-2">{row.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border p-2">{row.level ?? "-"}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border p-2">{row.depth}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   className={`border p-2 ${
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     row.paymentStatus === "Completed" ? "text-green-600" : "text-red-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   }`}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   {row.paymentStatus}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </table>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // export default AdminDownline;



// // // // // // // // // // // // // // // // // // // // // // // // // // // // // // src/components/AdminDownline.jsx
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState, useMemo } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // import { motion } from "framer-motion";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // /**
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //  * Recursive tree renderer
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //  * Shows each user as a card, and recursively renders children
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //  */
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // function TreeNode({ node }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Show node only if it is paid OR has at least one paid child
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const hasCompletedChildren =
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     Array.isArray(node.children) &&
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     node.children.some((c) => c.paymentStatus === "Completed");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (node.paymentStatus !== "Completed" && !hasCompletedChildren) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="flex flex-col items-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Node Card */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       <motion.div
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         className={`rounded-xl shadow-md px-4 py-3 mb-4 text-center w-44 ${
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           node.paymentStatus === "Completed"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             ? "bg-green-100 border border-green-400"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             : "bg-orange-100 border border-orange-400"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         }`}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         initial={{ scale: 0.8, opacity: 0 }}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         animate={{ scale: 1, opacity: 1 }}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="font-semibold text-gray-800">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="text-xs text-gray-600">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           Layer: {node.depth ? `Layer ${node.depth}` : "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="text-xs text-gray-500">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           {node.paymentStatus === "Completed" ? "‚úÖ Paid" : "‚è≥ Pending"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       </motion.div>

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Children */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {Array.isArray(node.children) && node.children.length > 0 && (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="flex gap-8 justify-center relative">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <div className="absolute top-0 left-1/2 w-px h-6 bg-gray-400"></div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           {node.children.map((child, i) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <div key={i} className="flex flex-col items-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <div className="w-px h-6 bg-gray-400"></div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <TreeNode node={child} />
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // /**
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //  * Flatten helpers to convert tree -> flat array for table view
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //  */
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // function flattenNode(node, acc) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node) return acc;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const hasCompletedChildren =
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     Array.isArray(node.children) &&
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     node.children.some((c) => c.paymentStatus === "Completed");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (node.paymentStatus !== "Completed" && !hasCompletedChildren) return acc;

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   acc.push(node);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (Array.isArray(node.children)) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     node.children.forEach((c) => flattenNode(c, acc));
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return acc;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // function flattenForest(forest) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const out = [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   (forest || []).forEach((root) => flattenNode(root, out));
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return out;
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // // /**
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //  * Main Component
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //  */
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [tree, setTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [downline, setDownline] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [error, setError] = useState("");
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [viewMode, setViewMode] = useState("tree");
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [depth, setDepth] = useState(3);

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const fetchData = async () => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setError("");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth });
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       if (!res.success)
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         throw new Error(res.message || "Failed to fetch downline");

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       const forest = res.data.tree || [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setTree(forest);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline(flattenForest(forest));
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setError(err.message || "Failed to load downline data");
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setTree([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   }, [depth]);

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   const totals = useMemo(
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     () => ({
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       nodes: downline.length,
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       roots: tree.length,
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     }),
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     [downline.length, tree.length]
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="max-w-6xl mx-auto p-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Header */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="flex justify-between items-center mb-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <h2 className="text-2xl font-bold">üìä Downline Network</h2>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="flex gap-3">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             className="px-4 py-2 border rounded-lg bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             onClick={() => setViewMode(viewMode === "tree" ? "table" : "tree")}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             {viewMode === "tree" ? "Show Table View" : "Show Tree View"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             className="px-4 py-2 border rounded-lg bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             onClick={fetchData}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <select
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             className="border rounded-lg px-3 py-2"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             value={depth}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             onChange={(e) => setDepth(parseInt(e.target.value, 10))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             {[...Array(10)].map((_, i) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <option key={i + 1} value={i + 1}>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 Layer {i + 1}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               </option>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </select>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Summary */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {!loading && !error && (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="mb-4 text-sm text-gray-500">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           Roots: {totals.roots} ‚Ä¢ Total nodes: {totals.nodes} ‚Ä¢ Showing:{" "}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           {depth} Layers
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Content */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div>üîÑ Loading...</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       ) : error ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="text-red-500">‚ùå {error}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       ) : viewMode === "tree" ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="flex justify-center overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           {Array.isArray(tree) && tree.length > 0 ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             tree.map((root, i) => <TreeNode key={i} node={root} />)
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <div>No tree data available</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           <table className="w-full border-collapse text-sm shadow rounded-lg">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2 text-left">User ID</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Layer</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="border px-4 py-2">Leg</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               {downline.map((u, i) => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 const layer = u.depth ? `Layer ${u.depth}` : "-";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   <tr
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     key={i}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     className="hover:bg-gray-50 transition-colors duration-150"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2">{u.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2 text-center">{layer}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       className={`border px-4 py-2 text-center font-semibold ${
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                         u.paymentStatus === "Completed"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                           ? "text-green-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                           : "text-orange-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       }`}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     >
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       {u.paymentStatus}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       {u.parentId ? u.parentId.slice(0, 6) + "..." : "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                       {u.leg || "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                     </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                   </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //                 );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //               })}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // // }




// // // // // // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // import { getDownlineTree } from "@/api/adminAPI";
// // // // // // // // // // // // // // // // // // // // // // // // // // // // import { Button } from "@/components/ui/button";

// // // // // // // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [downline, setDownline] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [depth, setDepth] = useState(1);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const [tableView, setTableView] = useState(false);

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   // Fetch data whenever depth changes
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const fetchDownline = async () => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       const res = await getDownlineTree(depth);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       const raw = res?.data?.tree ?? [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       const tree = Array.isArray(raw) ? raw : raw ? [raw] : [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline(tree);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       console.error("Failed to fetch downline:", err);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     fetchDownline();
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   }, [depth]);

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   // Recursively count nodes for stats
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const countNodes = (nodes) =>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     nodes.reduce(
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       (acc, node) => acc + 1 + (node.children ? countNodes(node.children) : 0),
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       0
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     );

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const totalNodes = countNodes(downline);

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   // üîë Filter table rows up to selected depth
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const flattenNodes = (nodes) => {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     for (const node of nodes) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       if (node.depth <= depth) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         if (node.children) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           result = [...result, ...flattenNodes(node.children)];
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   const tableRows = flattenNodes(downline);

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Stats */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       <p className="text-sm text-gray-600 mb-4">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         Roots: {downline.length} ‚Ä¢ Total nodes: {totalNodes} ‚Ä¢ Showing: {depth}{" "}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         {depth === 1 ? "Layer" : "Layers"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       </p>

// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="flex items-center gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <Button variant="outline" onClick={() => setTableView(!tableView)}>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           {tableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         </Button>

// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <Button variant="secondary" onClick={fetchDownline}>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         </Button>

// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           className="border rounded-lg px-3 py-2"
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           value={depth}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setDepth(parseInt(e.target.value, 10))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           {[...Array(10)].map((_, i) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <option key={i + 1} value={i + 1}>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               Layer {i + 1}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Loader */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {loading && <p className="text-gray-500">Loading...</p>}

// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Views */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {!loading && (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           {tableView ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <TableView rows={tableRows} />
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <TreeView nodes={downline} maxDepth={depth} />
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         </>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // /* ------------------------ TABLE VIEW ------------------------ */
// // // // // // // // // // // // // // // // // // // // // // // // // // // // function TableView({ rows }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       <table className="table-auto w-full border border-gray-300">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           <tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">User</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">Layer</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         </thead>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           {rows.length === 0 ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               <td colSpan={4} className="text-center p-4 text-gray-500">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 No data found
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             rows.map((u) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               <tr key={u.orderId}>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2">{u.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   Layer {u.depth}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   {u.parentId ? u.parentId.slice(0, 6) + "..." : "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                   {u.paymentStatus === "Completed" ? "‚úÖ Paid" : "‚ùå Unpaid"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //                 </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             ))
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         </tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       </table>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // /* ------------------------ TREE VIEW ------------------------ */
// // // // // // // // // // // // // // // // // // // // // // // // // // // // function TreeView({ nodes, maxDepth }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="flex flex-wrap gap-4">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {nodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <TreeNode key={node.orderId} node={node} maxDepth={maxDepth} />
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // // function TreeNode({ node, maxDepth }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node || node.depth > maxDepth) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-4 border rounded-2xl shadow bg-green-50 min-w-[140px]">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="text-xs text-gray-600">Layer: {node.depth}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="text-xs text-green-700">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         {node.paymentStatus === "Completed" ? "‚úÖ Paid" : "‚ùå Unpaid"}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Children */}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       {node.children?.length > 0 && node.depth < maxDepth && (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="ml-6 mt-3 border-l pl-4 space-y-2">
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           {node.children.map((child) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // // //             <TreeNode key={child.orderId} node={child} maxDepth={maxDepth} />
// // // // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // // }



// // // // // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi"; // ‚úÖ correct import

// // // // // // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // // // // // //   const [downline, setDownline] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // //   const [depth, setDepth] = useState(1);
// // // // // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // // // // // // // // // // // // // //   const [tableView, setTableView] = useState(false);

// // // // // // // // // // // // // // // // // // // // // // // // // // //   const fetchDownline = async () => {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth }); // ‚úÖ using adminAPI
// // // // // // // // // // // // // // // // // // // // // // // // // // //       const raw = res?.data?.tree ?? [];
// // // // // // // // // // // // // // // // // // // // // // // // // // //       const tree = Array.isArray(raw) ? raw : raw ? [raw] : [];
// // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline(tree);
// // // // // // // // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //       console.error("Failed to fetch downline:", err);
// // // // // // // // // // // // // // // // // // // // // // // // // // //       setDownline([]);
// // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     fetchDownline();
// // // // // // // // // // // // // // // // // // // // // // // // // // //   }, [depth]);

// // // // // // // // // // // // // // // // // // // // // // // // // // //   const countNodes = (nodes) =>
// // // // // // // // // // // // // // // // // // // // // // // // // // //     nodes.reduce(
// // // // // // // // // // // // // // // // // // // // // // // // // // //       (acc, node) => acc + 1 + (node.children ? countNodes(node.children) : 0),
// // // // // // // // // // // // // // // // // // // // // // // // // // //       0
// // // // // // // // // // // // // // // // // // // // // // // // // // //     );

// // // // // // // // // // // // // // // // // // // // // // // // // // //   const totalNodes = countNodes(downline);

// // // // // // // // // // // // // // // // // // // // // // // // // // //   const flattenNodes = (nodes) => {
// // // // // // // // // // // // // // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // // // // // // // // // // // // // //     for (const node of nodes) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //       if (node.depth <= depth) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // // // // // // // //         if (node.children) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //           result = [...result, ...flattenNodes(node.children)];
// // // // // // // // // // // // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // // //   const tableRows = flattenNodes(downline);

// // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // // // // // // // //       <p className="text-sm text-gray-600 mb-4">
// // // // // // // // // // // // // // // // // // // // // // // // // // //         Roots: {downline.length} ‚Ä¢ Total nodes: {totalNodes} ‚Ä¢ Showing: {depth}{" "}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         {depth === 1 ? "Layer" : "Layers"}
// // // // // // // // // // // // // // // // // // // // // // // // // // //       </p>

// // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="flex items-center gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded-lg hover:bg-gray-100"
// // // // // // // // // // // // // // // // // // // // // // // // // // //           onClick={() => setTableView(!tableView)}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // // // //           {tableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // // // // // // //           onClick={fetchDownline}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // // // // // // // //           className="border rounded-lg px-3 py-2"
// // // // // // // // // // // // // // // // // // // // // // // // // // //           value={depth}
// // // // // // // // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setDepth(parseInt(e.target.value, 10))}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // // // //           {[...Array(10)].map((_, i) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <option key={i + 1} value={i + 1}>
// // // // // // // // // // // // // // // // // // // // // // // // // // //               Layer {i + 1}
// // // // // // // // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // // //       {loading && <p className="text-gray-500">Loading...</p>}

// // // // // // // // // // // // // // // // // // // // // // // // // // //       {!loading && (
// // // // // // // // // // // // // // // // // // // // // // // // // // //         <>
// // // // // // // // // // // // // // // // // // // // // // // // // // //           {tableView ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <TableView rows={tableRows} />
// // // // // // // // // // // // // // // // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <TreeView nodes={downline} maxDepth={depth} />
// // // // // // // // // // // // // // // // // // // // // // // // // // //           )}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         </>
// // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // function TableView({ rows }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // // // //       <table className="table-auto w-full border border-gray-300">
// // // // // // // // // // // // // // // // // // // // // // // // // // //         <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // // // // // //           <tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">User</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">Layer</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <th className="border px-4 py-2">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // // // // // //           </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // //         </thead>
// // // // // // // // // // // // // // // // // // // // // // // // // // //         <tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // //           {rows.length === 0 ? (
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // //               <td colSpan={4} className="text-center p-4 text-gray-500">
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 No data found
// // // // // // // // // // // // // // // // // // // // // // // // // // //               </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // //             </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // // //             rows.map((u) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // //               <tr key={u.orderId}>
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2">{u.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   Layer {u.depth}
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   {u.parentId ? u.parentId.slice(0, 6) + "..." : "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 <td className="border px-4 py-2 text-center">
// // // // // // // // // // // // // // // // // // // // // // // // // // //                   {u.paymentStatus === "Completed" ? "‚úÖ Paid" : "‚ùå Unpaid"}
// // // // // // // // // // // // // // // // // // // // // // // // // // //                 </td>
// // // // // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // // //             ))
// // // // // // // // // // // // // // // // // // // // // // // // // // //           )}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         </tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // // //       </table>
// // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // function TreeView({ nodes, maxDepth }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="flex flex-wrap gap-4">
// // // // // // // // // // // // // // // // // // // // // // // // // // //       {nodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // //         <TreeNode key={node.orderId} node={node} maxDepth={maxDepth} />
// // // // // // // // // // // // // // // // // // // // // // // // // // //       ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // }

// // // // // // // // // // // // // // // // // // // // // // // // // // // function TreeNode({ node, maxDepth }) {
// // // // // // // // // // // // // // // // // // // // // // // // // // //   if (!node || node.depth > maxDepth) return null;

// // // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-4 border rounded-2xl shadow bg-green-50 min-w-[140px]">
// // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="text-xs text-gray-600">Layer: {node.depth}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="text-xs text-green-700">
// // // // // // // // // // // // // // // // // // // // // // // // // // //         {node.paymentStatus === "Completed" ? "‚úÖ Paid" : "‚ùå Unpaid"}
// // // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // // //       {node.children?.length > 0 && node.depth < maxDepth && (
// // // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="ml-6 mt-3 border-l pl-4 space-y-2">
// // // // // // // // // // // // // // // // // // // // // // // // // // //           {node.children.map((child) => (
// // // // // // // // // // // // // // // // // // // // // // // // // // //             <TreeNode key={child.orderId} node={child} maxDepth={maxDepth} />
// // // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // // // // // // // // src/pages/AdminDownline.jsx
// // // // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // // // // // // // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // // //   const [selectedLayer, setSelectedLayer] = useState(1);
// // // // // // // // // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);

// // // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Filter nodes layer-wise
// // // // // // // // // // // // // // // // // // // // // // // // // //   const getNodesByLayer = (tree, maxLayer) => {
// // // // // // // // // // // // // // // // // // // // // // // // // //     const result = [];
// // // // // // // // // // // // // // // // // // // // // // // // // //     const traverse = (node) => {
// // // // // // // // // // // // // // // // // // // // // // // // // //       if (node.depth <= maxLayer) {
// // // // // // // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // // // // // // //         node.children.forEach(traverse);
// // // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // // // // // // // // // // //     tree.forEach(traverse);
// // // // // // // // // // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Fetch & Build Tree
// // // // // // // // // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // // // //     const res = await adminAPI.getOrders();
// // // // // // // // // // // // // // // // // // // // // // // // // //     if (res.success) {
// // // // // // // // // // // // // // // // // // // // // // // // // //       const orders = res.data;
// // // // // // // // // // // // // // // // // // // // // // // // // //       const rootIds = orders.filter((o) => !o.parentId).map((o) => o._id);
// // // // // // // // // // // // // // // // // // // // // // // // // //       const tree = buildTernaryTree(orders, rootIds, 20);
// // // // // // // // // // // // // // // // // // // // // // // // // //       setFullTree(tree);
// // // // // // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(tree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // // //     if (fullTree.length > 0) {
// // // // // // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(fullTree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // // //   }, [selectedLayer, fullTree]);

// // // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Header Info */}
// // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total nodes: {filteredNodes.length} ‚Ä¢ Showing:{" "}
// // // // // // // // // // // // // // // // // // // // // // // // // //         {selectedLayer} Layer{selectedLayer > 1 ? "s" : ""}
// // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded"
// // // // // // // // // // // // // // // // // // // // // // // // // //           value={selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setSelectedLayer(Number(e.target.value))}
// // // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // // //           {[1, 2, 3, 4, 5].map((layer) => (
// // // // // // // // // // // // // // // // // // // // // // // // // //             <option key={layer} value={layer}>
// // // // // // // // // // // // // // // // // // // // // // // // // //               Layer {layer}
// // // // // // // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TABLE VIEW */
// // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // //               {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">Layer {node.depth}</td>
// // // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // // // // //                     {node.parentId || "-"}
// // // // // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // // // // //                     {node.paymentStatus === "Paid" ? "‚úÖ Paid" : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TREE VIEW */
// // // // // // // // // // // // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
// // // // // // // // // // // // // // // // // // // // // // // // // //           {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // // // // // // // // // // // // // // // // //               className="p-4 rounded-2xl shadow border bg-green-50 text-center"
// // // // // // // // // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // // // // // // // // //               <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // // // // //               <div className="text-sm text-gray-600">
// // // // // // // // // // // // // // // // // // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // // // // // // // // //                 {node.paymentStatus === "Paid" ? "‚úÖ Paid" : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // // // // // // // src/pages/AdminDownline.jsx
// // // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // // //   const [selectedLayer, setSelectedLayer] = useState(1);
// // // // // // // // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);

// // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Flatten tree layer-wise
// // // // // // // // // // // // // // // // // // // // // // // // //   const getNodesByLayer = (tree, maxLayer) => {
// // // // // // // // // // // // // // // // // // // // // // // // //     const result = [];
// // // // // // // // // // // // // // // // // // // // // // // // //     const traverse = (node) => {
// // // // // // // // // // // // // // // // // // // // // // // // //       if (node.depth <= maxLayer) {
// // // // // // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // // // // // //         if (node.children) node.children.forEach(traverse);
// // // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // // // // // // // // // //     tree.forEach(traverse);
// // // // // // // // // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Fetch tree from backend (instead of building manually)
// // // // // // // // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // // //     const res = await adminAPI.getDownlineStructure({ depth: 10 }); // fetch deeper
// // // // // // // // // // // // // // // // // // // // // // // // //     if (res.success) {
// // // // // // // // // // // // // // // // // // // // // // // // //       const tree = res.data.tree || [];
// // // // // // // // // // // // // // // // // // // // // // // // //       setFullTree(tree);
// // // // // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(tree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // //     setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // // //     if (fullTree.length > 0) {
// // // // // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(fullTree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // // //   }, [selectedLayer, fullTree]);

// // // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // // // // // //       {/* Header Info */}
// // // // // // // // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total nodes: {filteredNodes.length} ‚Ä¢ Showing:{" "}
// // // // // // // // // // // // // // // // // // // // // // // // //         {selectedLayer} Layer{selectedLayer > 1 ? "s" : ""}
// // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded"
// // // // // // // // // // // // // // // // // // // // // // // // //           value={selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setSelectedLayer(Number(e.target.value))}
// // // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // // //           {[1, 2, 3, 4, 5].map((layer) => (
// // // // // // // // // // // // // // // // // // // // // // // // //             <option key={layer} value={layer}>
// // // // // // // // // // // // // // // // // // // // // // // // //               Layer {layer}
// // // // // // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TABLE VIEW */
// // // // // // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // // // // // //               {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId || node._id}>
// // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">Layer {node.depth}</td>
// // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // // // //                     {node.parentId || "-"}
// // // // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TREE VIEW */
// // // // // // // // // // // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
// // // // // // // // // // // // // // // // // // // // // // // // //           {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // // // // // // // //               key={node.orderId || node._id}
// // // // // // // // // // // // // // // // // // // // // // // // //               className="p-4 rounded-2xl shadow border bg-green-50 text-center"
// // // // // // // // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // // // // // // // //               <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // // // //               <div className="text-sm text-gray-600">Layer: {node.depth}</div>
// // // // // // // // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // // // // // // src/pages/AdminDownline.jsx
// // // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // // //   const [selectedLayer, setSelectedLayer] = useState(1);
// // // // // // // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);

// // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ ‡§ï‡•á‡§µ‡§≤ ‡§â‡§∏‡•Ä layer ‡§ï‡•á nodes ‡§≤‡§æ‡§ì
// // // // // // // // // // // // // // // // // // // // // // // //   const getNodesByLayer = (tree, targetLayer) => {
// // // // // // // // // // // // // // // // // // // // // // // //     const result = [];
// // // // // // // // // // // // // // // // // // // // // // // //     const traverse = (node) => {
// // // // // // // // // // // // // // // // // // // // // // // //       const nodeDepth = node.depth || 1; // fallback ‡§Ö‡§ó‡§∞ depth missing ‡§π‡•ã
// // // // // // // // // // // // // // // // // // // // // // // //       if (nodeDepth === targetLayer) {
// // // // // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // //       if (node.children) node.children.forEach(traverse);
// // // // // // // // // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // // // // // // // // //     tree.forEach(traverse);
// // // // // // // // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Backend ‡§∏‡•á tree fetch ‡§ï‡§∞‡§®‡§æ
// // // // // // // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 10 }); // ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§ó‡§π‡§∞‡§æ‡§à ‡§§‡§ï ‡§≤‡§æ‡§ì
// // // // // // // // // // // // // // // // // // // // // // // //       //  console.log("üü° Raw response:", res);
// // // // // // // // // // // // // // // // // // // // // // // //       // if (res.success) {
// // // // // // // // // // // // // // // // // // // // // // // //       //   const tree = res.data?.tree || res.data?.data?.tree || [];
// // // // // // // // // // // // // // // // // // // // // // // //       //   // const tree = res.data.tree || [];
// // // // // // // // // // // // // // // // // // // // // // // //       //   setFullTree(tree);

// // // // // // // // // // // // // // // // // // // // // // // //       //   // debug log
// // // // // // // // // // // // // // // // // // // // // // // //       //   console.log("üì¶ Full Tree from backend:", tree);

// // // // // // // // // // // // // // // // // // // // // // // //       //   // ‡§™‡§π‡§≤‡•á fetch ‡§™‡§∞ default layer apply
// // // // // // // // // // // // // // // // // // // // // // // //       //   setFilteredNodes(getNodesByLayer(tree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // // //      if (res.success) {
// // // // // // // // // // // // // // // // // // // // // // // //       setFullTree(res.tree);
// // // // // // // // // // // // // // // // // // // // // // // //       console.log("üì¶ Full Tree from backend:", res.tree);
// // // // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(res.tree, selectedLayer));
    
// // // // // // // // // // // // // // // // // // // // // // // //     } else {
// // // // // // // // // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // // // // // // //     }, []);
    


// // // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // // //     if (fullTree.length > 0) {
// // // // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(fullTree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // // //   }, [selectedLayer, fullTree]);

// // // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // // // // //       {/* Header Info */}
// // // // // // // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total nodes: {filteredNodes.length} ‚Ä¢ Showing:{" "}
// // // // // // // // // // // // // // // // // // // // // // // //         Layer {selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded"
// // // // // // // // // // // // // // // // // // // // // // // //           value={selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setSelectedLayer(Number(e.target.value))}
// // // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // // //           {[1, 2, 3, 4, 5].map((layer) => (
// // // // // // // // // // // // // // // // // // // // // // // //             <option key={layer} value={layer}>
// // // // // // // // // // // // // // // // // // // // // // // //               Layer {layer}
// // // // // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TABLE VIEW */
// // // // // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // // // // //               {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId || node._id}>
// // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // // //                     Layer {node.depth || 1}
// // // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TREE VIEW */
// // // // // // // // // // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
// // // // // // // // // // // // // // // // // // // // // // // //           {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // // // // // // //               key={node.orderId || node._id}
// // // // // // // // // // // // // // // // // // // // // // // //               className="p-4 rounded-2xl shadow border bg-green-50 text-center"
// // // // // // // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // // // // // // //               <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // // //               <div className="text-sm text-gray-600">
// // // // // // // // // // // // // // // // // // // // // // // //                 Layer: {node.depth || 1}
// // // // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // // // // // src/pages/AdminDownline.jsx
// // // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // // // // // // // // // // // // // // // // // // // // // //   const [selectedLayer, setSelectedLayer] = useState(1);
// // // // // // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);

// // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Layer-wise nodes fetch (ternary aware)
// // // // // // // // // // // // // // // // // // // // // // //   const getNodesByLayer = (tree, targetLayer) => {
// // // // // // // // // // // // // // // // // // // // // // //     const result = [];

// // // // // // // // // // // // // // // // // // // // // // //     const traverse = (node, currentLayer = 1) => {
// // // // // // // // // // // // // // // // // // // // // // //       if (currentLayer === targetLayer) {
// // // // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // // // //       }

// // // // // // // // // // // // // // // // // // // // // // //       if (node.children && node.children.length) {
// // // // // // // // // // // // // // // // // // // // // // //         node.children.forEach((child) => traverse(child, currentLayer + 1));
// // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // // // // // // // //     tree.forEach((root) => traverse(root, 1));

// // // // // // // // // // // // // // // // // // // // // // //     // ‚úÖ Max nodes per layer = 3^(layer-1)
// // // // // // // // // // // // // // // // // // // // // // //     const maxNodes = Math.pow(3, targetLayer - 1);
// // // // // // // // // // // // // // // // // // // // // // //     const slicedResult = result.slice(0, maxNodes);

// // // // // // // // // // // // // // // // // // // // // // //     console.log(
// // // // // // // // // // // // // // // // // // // // // // //       `üîπ Layer ${targetLayer} nodes (max ${maxNodes}):`,
// // // // // // // // // // // // // // // // // // // // // // //       slicedResult.map((n) => n.userId)
// // // // // // // // // // // // // // // // // // // // // // //     );

// // // // // // // // // // // // // // // // // // // // // // //     return slicedResult;
// // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Fetch tree from backend
// // // // // // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 10 });

// // // // // // // // // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // // // // // // // // //         setFullTree(res.tree);
// // // // // // // // // // // // // // // // // // // // // // //         console.log("üì¶ Full Tree from backend:", res.tree);

// // // // // // // // // // // // // // // // // // // // // // //         // Default layer fetch
// // // // // // // // // // // // // // // // // // // // // // //         setFilteredNodes(getNodesByLayer(res.tree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // // //   // üîÑ Layer change effect
// // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // //     if (fullTree.length > 0) {
// // // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(fullTree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // // //   }, [selectedLayer, fullTree]);

// // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // // // //       {/* Header Info */}
// // // // // // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total nodes: {filteredNodes.length} ‚Ä¢ Showing:{" "}
// // // // // // // // // // // // // // // // // // // // // // //         Layer {selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded"
// // // // // // // // // // // // // // // // // // // // // // //           value={selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setSelectedLayer(Number(e.target.value))}
// // // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // // //           {[1, 2, 3, 4, 5].map((layer) => (
// // // // // // // // // // // // // // // // // // // // // // //             <option key={layer} value={layer}>
// // // // // // // // // // // // // // // // // // // // // // //               Layer {layer}
// // // // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TABLE VIEW */
// // // // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // // // //               {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId || node._id}>
// // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // //                     Layer {node.depth || selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TREE VIEW */
// // // // // // // // // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
// // // // // // // // // // // // // // // // // // // // // // //           {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // // // // // //               key={node.orderId || node._id}
// // // // // // // // // // // // // // // // // // // // // // //               className="p-4 rounded-2xl shadow border bg-green-50 text-center"
// // // // // // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // // // // // //               <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // // //               <div className="text-sm text-gray-600">
// // // // // // // // // // // // // // // // // // // // // // //                 Layer: {node.depth || selectedLayer}
// // // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // // // // src/pages/AdminDownline.jsx
// // // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // // // // // // // // // // // // // // // // // // // // //   const [selectedLayer, setSelectedLayer] = useState(1);
// // // // // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);

// // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Layer-wise nodes fetch (ternary aware)
// // // // // // // // // // // // // // // // // // // // // //   const getNodesByLayer = (tree, targetLayer) => {
// // // // // // // // // // // // // // // // // // // // // //     const result = [];

// // // // // // // // // // // // // // // // // // // // // //     const traverse = (node, currentLayer = 1) => {
// // // // // // // // // // // // // // // // // // // // // //       if (currentLayer === targetLayer) {
// // // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // //       if (node.children && node.children.length) {
// // // // // // // // // // // // // // // // // // // // // //         node.children.forEach((child) => traverse(child, currentLayer + 1));
// // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // // // // // // //     tree.forEach((root) => traverse(root, 1));

// // // // // // // // // // // // // // // // // // // // // //     // ‚úÖ Max nodes per layer = 3^(layer-1)
// // // // // // // // // // // // // // // // // // // // // //     const maxNodes = Math.pow(3, targetLayer - 1);
// // // // // // // // // // // // // // // // // // // // // //     const slicedResult = result.slice(0, maxNodes);

// // // // // // // // // // // // // // // // // // // // // //     console.log(
// // // // // // // // // // // // // // // // // // // // // //       `üîπ Layer ${targetLayer} nodes (max ${maxNodes}):`,
// // // // // // // // // // // // // // // // // // // // // //       slicedResult.map((n) => n.userId)
// // // // // // // // // // // // // // // // // // // // // //     );

// // // // // // // // // // // // // // // // // // // // // //     return slicedResult;
// // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Fetch tree from backend
// // // // // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 10 });

// // // // // // // // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // // // // // // // //         setFullTree(res.tree);
// // // // // // // // // // // // // // // // // // // // // //         console.log("üì¶ Full Tree from backend:", res.tree);

// // // // // // // // // // // // // // // // // // // // // //         // Default layer fetch
// // // // // // // // // // // // // // // // // // // // // //         setFilteredNodes(getNodesByLayer(res.tree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // // //   // üîÑ Layer change effect
// // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // //     if (fullTree.length > 0) {
// // // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(fullTree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // // //   }, [selectedLayer, fullTree]);

// // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // // //       {/* Header Info */}
// // // // // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total nodes: {filteredNodes.length} ‚Ä¢ Showing:{" "}
// // // // // // // // // // // // // // // // // // // // // //         Layer {selectedLayer}
// // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // // //         {/* ‚úÖ Layer dropdown 1‚Äì10 */}
// // // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded"
// // // // // // // // // // // // // // // // // // // // // //           value={selectedLayer}
// // // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setSelectedLayer(Number(e.target.value))}
// // // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // // //           {Array.from({ length: 10 }, (_, i) => i + 1).map((layer) => (
// // // // // // // // // // // // // // // // // // // // // //             <option key={layer} value={layer}>
// // // // // // // // // // // // // // // // // // // // // //               Layer {layer}
// // // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TABLE VIEW */
// // // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // // //               {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId || node._id}>
// // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">Layer {selectedLayer}</td>
// // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TREE VIEW */
// // // // // // // // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
// // // // // // // // // // // // // // // // // // // // // //           {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // // // // //               key={node.orderId || node._id}
// // // // // // // // // // // // // // // // // // // // // //               className="p-4 rounded-2xl shadow border bg-green-50 text-center"
// // // // // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // // // // //               <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // // //               <div className="text-sm text-gray-600">Layer: {selectedLayer}</div>
// // // // // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // // // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // // // // // // // // // // // // // // // // // // // //   const [selectedLayer, setSelectedLayer] = useState(1);
// // // // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);

// // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Layer-wise nodes fetch (ternary aware)
// // // // // // // // // // // // // // // // // // // // //   const getNodesByLayer = (tree, targetLayer) => {
// // // // // // // // // // // // // // // // // // // // //     const result = [];

// // // // // // // // // // // // // // // // // // // // //     const traverse = (node, currentLayer = 1) => {
// // // // // // // // // // // // // // // // // // // // //       if (currentLayer === targetLayer) {
// // // // // // // // // // // // // // // // // // // // //         result.push(node);
// // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // //       if (node.children && node.children.length) {
// // // // // // // // // // // // // // // // // // // // //         node.children.forEach((child) => traverse(child, currentLayer + 1));
// // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // // // // // //     tree.forEach((root) => traverse(root, 1));

// // // // // // // // // // // // // // // // // // // // //     // ‚úÖ Max nodes per layer = 3^(layer-1)
// // // // // // // // // // // // // // // // // // // // //     const maxNodes = Math.pow(3, targetLayer - 1);
// // // // // // // // // // // // // // // // // // // // //     const slicedResult = result.slice(0, maxNodes);

// // // // // // // // // // // // // // // // // // // // //     console.log(
// // // // // // // // // // // // // // // // // // // // //       `üîπ Layer ${targetLayer} nodes (max ${maxNodes}):`,
// // // // // // // // // // // // // // // // // // // // //       slicedResult.map((n) => ({ userId: n.userId, depth: n.depth }))
// // // // // // // // // // // // // // // // // // // // //     );

// // // // // // // // // // // // // // // // // // // // //     return slicedResult;
// // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // //   // ‚úÖ Fetch tree from backend
// // // // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 10 });

// // // // // // // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // // // // // // //         setFullTree(res.tree);
// // // // // // // // // // // // // // // // // // // // //         console.log("üì¶ Full Tree from backend:", res.tree);

// // // // // // // // // // // // // // // // // // // // //         // Default layer fetch
// // // // // // // // // // // // // // // // // // // // //         setFilteredNodes(getNodesByLayer(res.tree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // // //   // üîÑ Layer change effect
// // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // //     if (fullTree.length > 0) {
// // // // // // // // // // // // // // // // // // // // //       setFilteredNodes(getNodesByLayer(fullTree, selectedLayer));
// // // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // // //   }, [selectedLayer, fullTree]);

// // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // // //       {/* Header Info */}
// // // // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total nodes: {filteredNodes.length} ‚Ä¢ Showing:{" "}
// // // // // // // // // // // // // // // // // // // // //         Layer {selectedLayer}
// // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // // //         {/* ‚úÖ Layer dropdown 1‚Äì10 */}
// // // // // // // // // // // // // // // // // // // // //         <select
// // // // // // // // // // // // // // // // // // // // //           className="border px-3 py-2 rounded"
// // // // // // // // // // // // // // // // // // // // //           value={selectedLayer}
// // // // // // // // // // // // // // // // // // // // //           onChange={(e) => setSelectedLayer(Number(e.target.value))}
// // // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // // //           {Array.from({ length: 10 }, (_, i) => i + 1).map((layer) => (
// // // // // // // // // // // // // // // // // // // // //             <option key={layer} value={layer}>
// // // // // // // // // // // // // // // // // // // // //               Layer {layer}
// // // // // // // // // // // // // // // // // // // // //             </option>
// // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // //         </select>
// // // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TABLE VIEW */
// // // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // // //               {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId || node._id}>
// // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">Layer {node.depth}</td>
// // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // // //         /* ‚úÖ TREE VIEW */
// // // // // // // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4">
// // // // // // // // // // // // // // // // // // // // //           {filteredNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // // // //               key={node.orderId || node._id}
// // // // // // // // // // // // // // // // // // // // //               className="p-4 rounded-2xl shadow border bg-green-50 text-center"
// // // // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // // // //               <div className="font-bold">{node.userId}</div>
// // // // // // // // // // // // // // // // // // // // //               <div className="text-sm text-gray-600">Layer: {node.depth}</div>
// // // // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);

// // // // // // // // // // // // // // // // // // // //   // Track expanded nodes by their orderId
// // // // // // // // // // // // // // // // // // // //   const [expandedNodes, setExpandedNodes] = useState(new Set());

// // // // // // // // // // // // // // // // // // // //   const toggleNode = (orderId) => {
// // // // // // // // // // // // // // // // // // // //     setExpandedNodes((prev) => {
// // // // // // // // // // // // // // // // // // // //       const newSet = new Set(prev);
// // // // // // // // // // // // // // // // // // // //       if (newSet.has(orderId)) newSet.delete(orderId);
// // // // // // // // // // // // // // // // // // // //       else newSet.add(orderId);
// // // // // // // // // // // // // // // // // // // //       return newSet;
// // // // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // //   // Recursive function to flatten tree based on expanded nodes
// // // // // // // // // // // // // // // // // // // //   const getVisibleNodes = (nodes, depth = 1) => {
// // // // // // // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // // // // // // // // //       result.push({ ...node, depth });
// // // // // // // // // // // // // // // // // // // //       if (expandedNodes.has(node.orderId) && node.children.length > 0) {
// // // // // // // // // // // // // // // // // // // //         result = result.concat(getVisibleNodes(node.children, depth + 1));
// // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 10 });

// // // // // // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // // // // // //         setFullTree(res.tree);
// // // // // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // // // //   const visibleNodes = getVisibleNodes(fullTree);

// // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total visible nodes: {visibleNodes.length}
// // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // // //         </button>
// // // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // // //         /* Table View */
// // // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // //                     <span
// // // // // // // // // // // // // // // // // // // //                       className="cursor-pointer font-bold"
// // // // // // // // // // // // // // // // // // // //                       onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // // // // //                     >
// // // // // // // // // // // // // // // // // // // //                       {node.children.length > 0
// // // // // // // // // // // // // // // // // // // //                         ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // // // // //                           ? "‚ñº "
// // // // // // // // // // // // // // // // // // // //                           : "‚ñ∂ "
// // // // // // // // // // // // // // // // // // // //                         : ""}
// // // // // // // // // // // // // // // // // // // //                       {node.userId}
// // // // // // // // // // // // // // // // // // // //                     </span>
// // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // // //         /* Tree View */
// // // // // // // // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // // // // // // // // //               className="p-2 rounded border bg-green-50 cursor-pointer"
// // // // // // // // // // // // // // // // // // // //               onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // // //               <span className="font-bold">
// // // // // // // // // // // // // // // // // // // //                 {node.children.length > 0
// // // // // // // // // // // // // // // // // // // //                   ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // // // // //                     ? "‚ñº "
// // // // // // // // // // // // // // // // // // // //                     : "‚ñ∂ "
// // // // // // // // // // // // // // // // // // // //                   : ""}
// // // // // // // // // // // // // // // // // // // //                 {node.userId}
// // // // // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // // // // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // }



// // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // // //   const [expandedNodes, setExpandedNodes] = useState(new Set());

// // // // // // // // // // // // // // // // // // //   // Toggle expand/collapse for a node
// // // // // // // // // // // // // // // // // // //   const toggleNode = (orderId) => {
// // // // // // // // // // // // // // // // // // //     setExpandedNodes((prev) => {
// // // // // // // // // // // // // // // // // // //       const newSet = new Set(prev);
// // // // // // // // // // // // // // // // // // //       if (newSet.has(orderId)) newSet.delete(orderId);
// // // // // // // // // // // // // // // // // // //       else newSet.add(orderId);
// // // // // // // // // // // // // // // // // // //       return newSet;
// // // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // //   // Flatten tree based on expanded nodes
// // // // // // // // // // // // // // // // // // //   const getVisibleNodes = (nodes, depth = 1) => {
// // // // // // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // // // // // // // //       const nodeWithDepth = { ...node, depth };
// // // // // // // // // // // // // // // // // // //       result.push(nodeWithDepth);

// // // // // // // // // // // // // // // // // // //       if (expandedNodes.has(node.orderId) && node.children.length > 0) {
// // // // // // // // // // // // // // // // // // //         result = result.concat(getVisibleNodes(node.children, depth + 1));
// // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // //   // Fetch downline tree from backend
// // // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 10 });
// // // // // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // // // // //         // Ensure depth is set in tree itself (optional)
// // // // // // // // // // // // // // // // // // //         const setTreeDepth = (nodes, parentDepth = 0) => {
// // // // // // // // // // // // // // // // // // //           return nodes.map((node) => ({
// // // // // // // // // // // // // // // // // // //             ...node,
// // // // // // // // // // // // // // // // // // //             depth: parentDepth + 1,
// // // // // // // // // // // // // // // // // // //             children: setTreeDepth(node.children || [], parentDepth + 1),
// // // // // // // // // // // // // // // // // // //           }));
// // // // // // // // // // // // // // // // // // //         };
// // // // // // // // // // // // // // // // // // //         setFullTree(setTreeDepth(res.tree));
// // // // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // // //   const visibleNodes = getVisibleNodes(fullTree);

// // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total visible nodes: {visibleNodes.length}
// // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // // //         </button>
// // // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // // //         // Table View
// // // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // //                     <span
// // // // // // // // // // // // // // // // // // //                       className="cursor-pointer font-bold"
// // // // // // // // // // // // // // // // // // //                       onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // // // //                     >
// // // // // // // // // // // // // // // // // // //                       {node.children.length > 0
// // // // // // // // // // // // // // // // // // //                         ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // // // //                           ? "‚ñº "
// // // // // // // // // // // // // // // // // // //                           : "‚ñ∂ "
// // // // // // // // // // // // // // // // // // //                         : ""}
// // // // // // // // // // // // // // // // // // //                       {node.userId}
// // // // // // // // // // // // // // // // // // //                     </span>
// // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // // //         // Tree View
// // // // // // // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // // // // // // // //               className="p-2 rounded border bg-green-50 cursor-pointer"
// // // // // // // // // // // // // // // // // // //               onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // //               <span className="font-bold">
// // // // // // // // // // // // // // // // // // //                 {node.children.length > 0
// // // // // // // // // // // // // // // // // // //                   ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // // // //                     ? "‚ñº "
// // // // // // // // // // // // // // // // // // //                     : "‚ñ∂ "
// // // // // // // // // // // // // // // // // // //                   : ""}
// // // // // // // // // // // // // // // // // // //                 {node.userId}
// // // // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // // // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // // //   const [expandedNodes, setExpandedNodes] = useState(new Set());

// // // // // // // // // // // // // // // // // //   // Toggle expand/collapse for a node
// // // // // // // // // // // // // // // // // //   const toggleNode = (orderId) => {
// // // // // // // // // // // // // // // // // //     setExpandedNodes((prev) => {
// // // // // // // // // // // // // // // // // //       const newSet = new Set(prev);
// // // // // // // // // // // // // // // // // //       if (newSet.has(orderId)) newSet.delete(orderId);
// // // // // // // // // // // // // // // // // //       else newSet.add(orderId);
// // // // // // // // // // // // // // // // // //       return newSet;
// // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // //   // Flatten tree based on expanded nodes
// // // // // // // // // // // // // // // // // //   const getVisibleNodes = (nodes, depth = 1) => {
// // // // // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // // // // // // //       const nodeWithDepth = { ...node, depth };
// // // // // // // // // // // // // // // // // //       result.push(nodeWithDepth);

// // // // // // // // // // // // // // // // // //       if (expandedNodes.has(node.orderId) && node.children.length > 0) {
// // // // // // // // // // // // // // // // // //         result = result.concat(getVisibleNodes(node.children, depth + 1));
// // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // //   // Fetch downline data
// // // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 10 });
// // // // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // // // //         // Build ternary tree with correct depth
// // // // // // // // // // // // // // // // // //         const tree = buildTernaryTree(res.tree, [], 10);
// // // // // // // // // // // // // // // // // //         setFullTree(tree);
// // // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // // //   const visibleNodes = getVisibleNodes(fullTree);

// // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total visible nodes: {visibleNodes.length}
// // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // // //         </button>
// // // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // // //         // Table View
// // // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // //                     <span
// // // // // // // // // // // // // // // // // //                       className="cursor-pointer font-bold"
// // // // // // // // // // // // // // // // // //                       onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // // //                     >
// // // // // // // // // // // // // // // // // //                       {node.children.length > 0
// // // // // // // // // // // // // // // // // //                         ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // // //                           ? "‚ñº "
// // // // // // // // // // // // // // // // // //                           : "‚ñ∂ "
// // // // // // // // // // // // // // // // // //                         : ""}
// // // // // // // // // // // // // // // // // //                       {node.userId}
// // // // // // // // // // // // // // // // // //                     </span>
// // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // // //         // Tree View
// // // // // // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // // // // // // //               className="p-2 rounded border bg-green-50 cursor-pointer"
// // // // // // // // // // // // // // // // // //               onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // //               <span className="font-bold">
// // // // // // // // // // // // // // // // // //                 {node.children.length > 0
// // // // // // // // // // // // // // // // // //                   ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // // //                     ? "‚ñº "
// // // // // // // // // // // // // // // // // //                     : "‚ñ∂ "
// // // // // // // // // // // // // // // // // //                   : ""}
// // // // // // // // // // // // // // // // // //                 {node.userId}
// // // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // // //   const [expandedNodes, setExpandedNodes] = useState(new Set());

// // // // // // // // // // // // // // // // //   // Toggle single node
// // // // // // // // // // // // // // // // //   const toggleNode = (orderId) => {
// // // // // // // // // // // // // // // // //     setExpandedNodes((prev) => {
// // // // // // // // // // // // // // // // //       const newSet = new Set(prev);
// // // // // // // // // // // // // // // // //       if (newSet.has(orderId)) newSet.delete(orderId);
// // // // // // // // // // // // // // // // //       else newSet.add(orderId);
// // // // // // // // // // // // // // // // //       return newSet;
// // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // //   // Flatten tree based on expanded nodes
// // // // // // // // // // // // // // // // //   const getVisibleNodes = (nodes, depth = 1) => {
// // // // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // // // // // //       const nodeWithDepth = { ...node, depth };
// // // // // // // // // // // // // // // // //       result.push(nodeWithDepth);

// // // // // // // // // // // // // // // // //       if (expandedNodes.has(node.orderId) && node.children.length > 0) {
// // // // // // // // // // // // // // // // //         result = result.concat(getVisibleNodes(node.children, depth + 1));
// // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // //   // Expand/collapse entire layer
// // // // // // // // // // // // // // // // //   const toggleLayer = (targetLayer, expand = true) => {
// // // // // // // // // // // // // // // // //     const newSet = new Set(expandedNodes);
// // // // // // // // // // // // // // // // //     const traverse = (nodes) => {
// // // // // // // // // // // // // // // // //       nodes.forEach((node) => {
// // // // // // // // // // // // // // // // //         if (node.depth === targetLayer) {
// // // // // // // // // // // // // // // // //           if (expand) newSet.add(node.orderId);
// // // // // // // // // // // // // // // // //           else newSet.delete(node.orderId);
// // // // // // // // // // // // // // // // //         }
// // // // // // // // // // // // // // // // //         if (node.children.length > 0) traverse(node.children);
// // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // //     traverse(fullTree);
// // // // // // // // // // // // // // // // //     setExpandedNodes(newSet);
// // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // //   // Fetch downline data
// // // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 20 });
// // // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // // //         const tree = buildTernaryTree(res.tree, 20);
// // // // // // // // // // // // // // // // //         setFullTree(tree);
// // // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // //   const visibleNodes = getVisibleNodes(fullTree);

// // // // // // // // // // // // // // // // //   // Determine max layer for buttons
// // // // // // // // // // // // // // // // //   const maxLayer = Math.max(...visibleNodes.map((n) => n.depth), 1);

// // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Total visible nodes: {visibleNodes.length}
// // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // // //         {/* Per-layer expand/collapse buttons */}
// // // // // // // // // // // // // // // // //         {[...Array(maxLayer)].map((_, i) => (
// // // // // // // // // // // // // // // // //           <div key={i} className="flex gap-1">
// // // // // // // // // // // // // // // // //             <button
// // // // // // // // // // // // // // // // //               onClick={() => toggleLayer(i + 1, true)}
// // // // // // // // // // // // // // // // //               className="px-2 py-1 rounded bg-green-500 text-white hover:bg-green-600 text-xs"
// // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // //               Expand Layer {i + 1}
// // // // // // // // // // // // // // // // //             </button>
// // // // // // // // // // // // // // // // //             <button
// // // // // // // // // // // // // // // // //               onClick={() => toggleLayer(i + 1, false)}
// // // // // // // // // // // // // // // // //               className="px-2 py-1 rounded bg-red-500 text-white hover:bg-red-600 text-xs"
// // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // //               Collapse Layer {i + 1}
// // // // // // // // // // // // // // // // //             </button>
// // // // // // // // // // // // // // // // //           </div>
// // // // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // // //         // Table View
// // // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // //                     <span
// // // // // // // // // // // // // // // // //                       className="cursor-pointer font-bold"
// // // // // // // // // // // // // // // // //                       onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // //                     >
// // // // // // // // // // // // // // // // //                       {node.children.length > 0
// // // // // // // // // // // // // // // // //                         ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // //                           ? "‚ñº "
// // // // // // // // // // // // // // // // //                           : "‚ñ∂ "
// // // // // // // // // // // // // // // // //                         : ""}
// // // // // // // // // // // // // // // // //                       {node.userId}
// // // // // // // // // // // // // // // // //                     </span>
// // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // // //         // Tree View
// // // // // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // // // // // //               className="p-2 rounded border bg-green-50 cursor-pointer"
// // // // // // // // // // // // // // // // //               onClick={() => toggleNode(node.orderId)}
// // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // //               <span className="font-bold">
// // // // // // // // // // // // // // // // //                 {node.children.length > 0
// // // // // // // // // // // // // // // // //                   ? expandedNodes.has(node.orderId)
// // // // // // // // // // // // // // // // //                     ? "‚ñº "
// // // // // // // // // // // // // // // // //                     : "‚ñ∂ "
// // // // // // // // // // // // // // // // //                   : ""}
// // // // // // // // // // // // // // // // //                 {node.userId}
// // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);

// // // // // // // // // // // // // // // //   // Fetch downline data from backend
// // // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 20 });
// // // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // // //         const tree = buildTernaryTree(res.tree, 20);
// // // // // // // // // // // // // // // //         setFullTree(tree);
// // // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // //   // Flatten tree and filter nodes by visible layer
// // // // // // // // // // // // // // // //   const getVisibleNodes = (nodes, targetLayer = 1, depth = 1) => {
// // // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // // // // //       if (depth === targetLayer) {
// // // // // // // // // // // // // // // //         result.push({ ...node, depth });
// // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // //       if (node.children.length > 0) {
// // // // // // // // // // // // // // // //         result = result.concat(getVisibleNodes(node.children, targetLayer, depth + 1));
// // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // //   const visibleNodes = getVisibleNodes(fullTree, visibleLayer);

// // // // // // // // // // // // // // // //   // Determine max layer
// // // // // // // // // // // // // // // //   const maxLayer = fullTree.length
// // // // // // // // // // // // // // // //     ? Math.max(...fullTree.map((n) => n.depth || 1), 1) + 3
// // // // // // // // // // // // // // // //     : 1;

// // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold flex items-center gap-2">
// // // // // // // // // // // // // // // //         üìä Downline Network
// // // // // // // // // // // // // // // //       </h2>

// // // // // // // // // // // // // // // //       <div className="text-gray-600 mt-1 mb-4">
// // // // // // // // // // // // // // // //         Roots: {fullTree.length} ‚Ä¢ Nodes in Layer {visibleLayer}: {visibleNodes.length}
// // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // //       {/* Controls */}
// // // // // // // // // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // // //         {/* Layer buttons */}
// // // // // // // // // // // // // // // //         {[...Array(maxLayer)].map((_, i) => (
// // // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // // //             key={i}
// // // // // // // // // // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // // // // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // // // // // // // // // //               visibleLayer === i + 1 ? "bg-green-600" : "bg-gray-400 hover:bg-gray-500"
// // // // // // // // // // // // // // // //             }`}
// // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // //             Layer {i + 1}
// // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // // //         // Table View
// // // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // //                 <tr key={node._id}>
// // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // // //         // Tree View
// // // // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // // //               key={node._id}
// // // // // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">Layer: {node.depth}</span>
// // // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // }



// // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);

// // // // // // // // // // // // // // //   // Fetch downline data
// // // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 20 });
// // // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // // //         const tree = buildTernaryTree(res.tree, 20);
// // // // // // // // // // // // // // //         setFullTree(tree);
// // // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // //   // Get nodes of a specific layer
// // // // // // // // // // // // // // //   const getNodesByLayer = (nodes, targetLayer, currentDepth = 1) => {
// // // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // // // //       if (currentDepth === targetLayer) {
// // // // // // // // // // // // // // //         result.push({ ...node, depth: currentDepth });
// // // // // // // // // // // // // // //       } else if (node.children && node.children.length > 0) {
// // // // // // // // // // // // // // //         result = result.concat(getNodesByLayer(node.children, targetLayer, currentDepth + 1));
// // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // // // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // // //         >
// // // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // // //         {/* Layer selection buttons */}
// // // // // // // // // // // // // // //         {[...Array(10)].map((_, i) => (
// // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // //             key={i}
// // // // // // // // // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // // // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // // // // // // // // //               visibleLayer === i + 1 ? "bg-green-600" : "bg-gray-500 hover:bg-gray-600"
// // // // // // // // // // // // // // //             }`}
// // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // //             Layer {i + 1}
// // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // //       <div className="mb-4 text-gray-600">
// // // // // // // // // // // // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // // //         // Table View
// // // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // // //         // Tree View
// // // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">Layer: {node.depth}</span>
// // // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // }


// // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);

// // // // // // // // // // // // // //   // Fetch downline data
// // // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 20 });
// // // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // // //         // ‚úÖ Corrected: pass [] for rootIds, 20 for maxDepth
// // // // // // // // // // // // // //         const tree = buildTernaryTree(res.tree, [], 20);
// // // // // // // // // // // // // //         setFullTree(tree);
// // // // // // // // // // // // // //       } else {
// // // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // // //       }
// // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   };

// // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // //   // Get nodes of a specific layer
// // // // // // // // // // // // // //   const getNodesByLayer = (nodes, targetLayer, currentDepth = 1) => {
// // // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // // //       if (currentDepth === targetLayer) {
// // // // // // // // // // // // // //         result.push({ ...node, depth: currentDepth });
// // // // // // // // // // // // // //       } else if (node.children && node.children.length > 0) {
// // // // // // // // // // // // // //         result = result.concat(
// // // // // // // // // // // // // //           getNodesByLayer(node.children, targetLayer, currentDepth + 1)
// // // // // // // // // // // // // //         );
// // // // // // // // // // // // // //       }
// // // // // // // // // // // // // //     });
// // // // // // // // // // // // // //     return result;
// // // // // // // // // // // // // //   };

// // // // // // // // // // // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // // //         >
// // // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // //         <button
// // // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // // //         >
// // // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // // //         </button>

// // // // // // // // // // // // // //         {/* Layer selection buttons */}
// // // // // // // // // // // // // //         {[...Array(10)].map((_, i) => (
// // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // //             key={i}
// // // // // // // // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // // // // // // // //               visibleLayer === i + 1
// // // // // // // // // // // // // //                 ? "bg-green-600"
// // // // // // // // // // // // // //                 : "bg-gray-500 hover:bg-gray-600"
// // // // // // // // // // // // // //             }`}
// // // // // // // // // // // // // //           >
// // // // // // // // // // // // // //             Layer {i + 1}
// // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // //       <div className="mb-4 text-gray-600">
// // // // // // // // // // // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // // //         // Table View
// // // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // // //                 <tr key={node._id}>
// // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // // //         // Tree View
// // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // // //             <div
// // // // // // // // // // // // // //               key={node._id}
// // // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // // // // // // // //             >
// // // // // // // // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // // // // // //               </span>
// // // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // }



// // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);

// // // // // // // // // // // // //   // Fetch downline data
// // // // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // // // //     try {
// // // // // // // // // // // // //       setLoading(true);
// // // // // // // // // // // // //       const res = await adminAPI.getDownlineStructure({ depth: 20 });
// // // // // // // // // // // // //       if (res.success) {
// // // // // // // // // // // // //         // ‚úÖ build tree correctly
// // // // // // // // // // // // //         const tree = buildTernaryTree(res.tree, [], 20);

// // // // // // // // // // // // //         // ‚úÖ pick only the main root (parentId == null)
// // // // // // // // // // // // //         const rootNode = Array.isArray(tree)
// // // // // // // // // // // // //           ? tree.find((n) => !n.parentId)
// // // // // // // // // // // // //           : tree;

// // // // // // // // // // // // //         setFullTree(rootNode ? [rootNode] : []);
// // // // // // // // // // // // //       } else {
// // // // // // // // // // // // //         console.error("‚ùå Failed to fetch downline:", res.message);
// // // // // // // // // // // // //       }
// // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // //       console.error("‚ùå Error fetching downline:", err);
// // // // // // // // // // // // //     } finally {
// // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // //     }
// // // // // // // // // // // // //   };

// // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // //   //Get nodes of a specific layer
// // // // // // // // // // // // //   const getNodesByLayer = (nodes, targetLayer, currentDepth = 1) => {
// // // // // // // // // // // // //     let result = [];
// // // // // // // // // // // // //     nodes.forEach((node) => {
// // // // // // // // // // // // //       if (currentDepth === targetLayer) {
// // // // // // // // // // // // //         result.push({ ...node, depth: currentDepth });
// // // // // // // // // // // // //       } else if (node.children && node.children.length > 0) {
// // // // // // // // // // // // //         result = result.concat(
// // // // // // // // // // // // //           getNodesByLayer(node.children, targetLayer, currentDepth + 1)
// // // // // // // // // // // // //         );
// // // // // // // // // // // // //       }
// // // // // // // // // // // // //     });
// // // // // // // // // // // // //     return result;
// // // // // // // // // // // // //   };


// // // // // // // // // // // // // //   // Get nodes of a specific layer
// // // // // // // // // // // // // // const getNodesByLayer = (nodes, targetLayer) => {
// // // // // // // // // // // // // //   let result = [];
// // // // // // // // // // // // // //   nodes.forEach((node) => {
// // // // // // // // // // // // // //     if (node.depth === targetLayer) {
// // // // // // // // // // // // // //       result.push(node);
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //     if (node.children && node.children.length > 0) {
// // // // // // // // // // // // // //       result = result.concat(getNodesByLayer(node.children, targetLayer));
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   });
// // // // // // // // // // // // // //   return result;
// // // // // // // // // // // // // // };


// // // // // // // // // // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // // // // // // // // // //   return (
// // // // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // // // // // //         <button
// // // // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // // // //         >
// // // // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // // // //         </button>

// // // // // // // // // // // // //         <button
// // // // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // // // //         >
// // // // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // // // //         </button>

// // // // // // // // // // // // //         {/* Layer selection buttons */}
// // // // // // // // // // // // //         {[...Array(10)].map((_, i) => (
// // // // // // // // // // // // //           <button
// // // // // // // // // // // // //             key={i}
// // // // // // // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // // // // // // //               visibleLayer === i + 1
// // // // // // // // // // // // //                 ? "bg-green-600"
// // // // // // // // // // // // //                 : "bg-gray-500 hover:bg-gray-600"
// // // // // // // // // // // // //             }`}
// // // // // // // // // // // // //           >
// // // // // // // // // // // // //             Layer {i + 1}
// // // // // // // // // // // // //           </button>
// // // // // // // // // // // // //         ))}
// // // // // // // // // // // // //       </div>

// // // // // // // // // // // // //       <div className="mb-4 text-gray-600">
// // // // // // // // // // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // // // // // // // // // //       </div>

// // // // // // // // // // // // //       {loading ? (
// // // // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // // // //         // Table View
// // // // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // // // //               <tr>
// // // // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // //               ))}
// // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // //           </table>
// // // // // // // // // // // // //         </div>
// // // // // // // // // // // // //       ) : (
// // // // // // // // // // // // //         // Tree View
// // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // // // //             <div
// // // // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // // // // // // //             >
// // // // // // // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // // // // //               </span>
// // // // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // // // //               </div>
// // // // // // // // // // // // //             </div>
// // // // // // // // // // // // //           ))}
// // // // // // // // // // // // //         </div>
// // // // // // // // // // // // //       )}
// // // // // // // // // // // // //     </div>
// // // // // // // // // // // // //   );
// // // // // // // // // // // // // }



// // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // ‚úÖ helper ‚Üí filter nodes by selected layer
// // // // // // // // // // function getNodesByLayer(tree, layer) {
// // // // // // // // // //   const result = [];

// // // // // // // // // //   function traverse(node) {
// // // // // // // // // //     if (node.depth === layer) result.push(node);
// // // // // // // // // //     node.children.forEach(traverse);
// // // // // // // // // //   }

// // // // // // // // // //   tree.forEach(traverse);
// // // // // // // // // //   return result;
// // // // // // // // // // }

// // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);
// // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);

// // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // //     setLoading(true);
// // // // // // // // // //     try {
// // // // // // // // // //       // ‚úÖ fetch orders
// // // // // // // // // //       const res = await adminAPI.getOrders();
// // // // // // // // // //       if (res.success && Array.isArray(res.data)) {
// // // // // // // // // //         // ‚úÖ build ternary tree
// // // // // // // // // //         const tree = buildTernaryTree(res.data, [], 10);
// // // // // // // // // //         setFullTree(tree);
// // // // // // // // // //       }
// // // // // // // // // //     } catch (err) {
// // // // // // // // // //       console.error("Error fetching downline:", err);
// // // // // // // // // //     } finally {
// // // // // // // // // //       setLoading(false);
// // // // // // // // // //     }
// // // // // // // // // //   };

// // // // // // // // // //   useEffect(() => {
// // // // // // // // // //     fetchDownlineData();
// // // // // // // // // //   }, []);

// // // // // // // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // // // // // // //   return (
// // // // // // // // // //     <div className="p-6">
// // // // // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // // //         <button
// // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // //         >
// // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // //         </button>

// // // // // // // // // //         <button
// // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // //         >
// // // // // // // // // //           üîÑ Refresh
// // // // // // // // // //         </button>

// // // // // // // // // //         {/* Layer selection buttons */}
// // // // // // // // // //         {[...Array(10)].map((_, i) => (
// // // // // // // // // //           <button
// // // // // // // // // //             key={i}
// // // // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // // // //               visibleLayer === i + 1
// // // // // // // // // //                 ? "bg-green-600"
// // // // // // // // // //                 : "bg-gray-500 hover:bg-gray-600"
// // // // // // // // // //             }`}
// // // // // // // // // //           >
// // // // // // // // // //             Layer {i + 1}
// // // // // // // // // //           </button>
// // // // // // // // // //         ))}
// // // // // // // // // //       </div>

// // // // // // // // // //       <div className="mb-4 text-gray-600">
// // // // // // // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // // // // // // //       </div>

// // // // // // // // // //       {loading ? (
// // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // //         // ‚úÖ Table View
// // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // //               <tr>
// // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // //               </tr>
// // // // // // // // // //             </thead>
// // // // // // // // // //             <tbody>
// // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // //                   </td>
// // // // // // // // // //                 </tr>
// // // // // // // // // //               ))}
// // // // // // // // // //             </tbody>
// // // // // // // // // //           </table>
// // // // // // // // // //         </div>
// // // // // // // // // //       ) : (
// // // // // // // // // //         // ‚úÖ Tree View
// // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // //             <div
// // // // // // // // // //               key={node.orderId}
// // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // // // //             >
// // // // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // //                 Layer: {node.depth}
// // // // // // // // // //               </span>
// // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // //               </div>
// // // // // // // // // //             </div>
// // // // // // // // // //           ))}
// // // // // // // // // //         </div>
// // // // // // // // // //       )}
// // // // // // // // // //     </div>
// // // // // // // // // //   );
// // // // // // // // // // }


// // // // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // // // helper ‚Üí filter nodes by selected layer
// // // // // // // // // // // function getNodesByLayer(tree, layer) {
// // // // // // // // // // //   const result = [];
// // // // // // // // // // //   function traverse(node) {
// // // // // // // // // // //     if (node.depth === layer) result.push(node);
// // // // // // // // // // //     node.children.forEach(traverse);
// // // // // // // // // // //   }
// // // // // // // // // // //   tree.forEach(traverse);
// // // // // // // // // // //   return result;
// // // // // // // // // // // }

// // // // // // // // // // // // helper ‚Üí map orderId to node for parent lookup
// // // // // // // // // // // function createNodeMap(tree) {
// // // // // // // // // // //   const map = new Map();
// // // // // // // // // // //   function traverse(node) {
// // // // // // // // // // //     map.set(node.orderId, node);
// // // // // // // // // // //     node.children.forEach(traverse);
// // // // // // // // // // //   }
// // // // // // // // // // //   tree.forEach(traverse);
// // // // // // // // // // //   return map;
// // // // // // // // // // // }

// // // // // // // // // // // export default function AdminDownline() {
// // // // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);
// // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // // // // // // // //   const [nodeMap, setNodeMap] = useState(new Map());

// // // // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // // // //     setLoading(true);
// // // // // // // // // // //     try {
// // // // // // // // // // //       const res = await adminAPI.getOrders();
// // // // // // // // // // //       if (res.success && Array.isArray(res.data)) {
// // // // // // // // // // //         const tree = buildTernaryTree(res.data, [], 10);
// // // // // // // // // // //         setFullTree(tree);
// // // // // // // // // // //         setNodeMap(createNodeMap(tree));
// // // // // // // // // // //       }
// // // // // // // // // // //     } catch (err) {
// // // // // // // // // // //       console.error("Error fetching downline:", err);
// // // // // // // // // // //     } finally {
// // // // // // // // // // //       setLoading(false);
// // // // // // // // // // //     }
// // // // // // // // // // //   };

// // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // //     fetchDownlineData();
// // // // // // // // // // //   }, []);

// // // // // // // // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // // // // // // // //   return (
// // // // // // // // // // //     <div className="p-6">
// // // // // // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // // // //         <button
// // // // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // // // //         >
// // // // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // // // //         </button>

// // // // // // // // // // //         <button
// // // // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // // // //         >
// // // // // // // // // // //           üîÑ Refresh
// // // // // // // // // // //         </button>

// // // // // // // // // // //         {[...Array(10)].map((_, i) => (
// // // // // // // // // // //           <button
// // // // // // // // // // //             key={i}
// // // // // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // // // // //               visibleLayer === i + 1
// // // // // // // // // // //                 ? "bg-green-600"
// // // // // // // // // // //                 : "bg-gray-500 hover:bg-gray-600"
// // // // // // // // // // //             }`}
// // // // // // // // // // //           >
// // // // // // // // // // //             Layer {i + 1}
// // // // // // // // // // //           </button>
// // // // // // // // // // //         ))}
// // // // // // // // // // //       </div>

// // // // // // // // // // //       <div className="mb-4 text-gray-600">
// // // // // // // // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // // // // // // // //       </div>

// // // // // // // // // // //       {loading ? (
// // // // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // // // //       ) : isTableView ? (
// // // // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // // // //               <tr>
// // // // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // // // //               </tr>
// // // // // // // // // // //             </thead>
// // // // // // // // // // //             <tbody>
// // // // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // //                     {node.parentId
// // // // // // // // // // //                       ? nodeMap.get(node.parentId)?.userId || "-"
// // // // // // // // // // //                       : "-"}
// // // // // // // // // // //                   </td>
// // // // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // // // //                   </td>
// // // // // // // // // // //                 </tr>
// // // // // // // // // // //               ))}
// // // // // // // // // // //             </tbody>
// // // // // // // // // // //           </table>
// // // // // // // // // // //         </div>
// // // // // // // // // // //       ) : (
// // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // // // //             <div
// // // // // // // // // // //               key={node.orderId}
// // // // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // // // // //             >
// // // // // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // // // //                 Layer: {node.depth} {node.leg ? `‚Ä¢ Leg: ${node.leg}` : ""}
// // // // // // // // // // //               </span>
// // // // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // // // //               </div>
// // // // // // // // // // //             </div>
// // // // // // // // // // //           ))}
// // // // // // // // // // //         </div>
// // // // // // // // // // //       )}
// // // // // // // // // // //     </div>
// // // // // // // // // // //   );
// // // // // // // // // // // }

// // // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // // ‚úÖ helper ‚Üí filter nodes by selected layer
// // // // // // // // // function getNodesByLayer(tree, layer) {
// // // // // // // // //   const result = [];
// // // // // // // // //   function traverse(node) {
// // // // // // // // //     if (node.depth === layer) result.push(node);
// // // // // // // // //     if (node.children) node.children.forEach(traverse);
// // // // // // // // //   }
// // // // // // // // //   tree.forEach(traverse);
// // // // // // // // //   return result;
// // // // // // // // // }

// // // // // // // // // export default function AdminDownline() {
// // // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);
// // // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // // //   const [isTableView, setIsTableView] = useState(false);

// // // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // // //     setLoading(true);
// // // // // // // // //     try {
// // // // // // // // //       const res = await adminAPI.getOrders();
// // // // // // // // //       if (res.success && Array.isArray(res.data)) {
// // // // // // // // //         // ‚úÖ build ternary tree with proper depth & children
// // // // // // // // //         const tree = buildTernaryTree(res.data, [], 10); 
// // // // // // // // //         setFullTree(tree);
// // // // // // // // //       }
// // // // // // // // //     } catch (err) {
// // // // // // // // //       console.error("Error fetching downline:", err);
// // // // // // // // //     } finally {
// // // // // // // // //       setLoading(false);
// // // // // // // // //     }
// // // // // // // // //   };

// // // // // // // // //   useEffect(() => {
// // // // // // // // //     fetchDownlineData();
// // // // // // // // //   }, []);

// // // // // // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // // // // // //   return (
// // // // // // // // //     <div className="p-6">
// // // // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // // //         <button
// // // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // // //         >
// // // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // // //         </button>

// // // // // // // // //         <button
// // // // // // // // //           onClick={fetchDownlineData}
// // // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // // //         >
// // // // // // // // //           üîÑ Refresh
// // // // // // // // //         </button>

// // // // // // // // //         {/* Layer selection buttons */}
// // // // // // // // //         {[...Array(10)].map((_, i) => (
// // // // // // // // //           <button
// // // // // // // // //             key={i}
// // // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // // //               visibleLayer === i + 1
// // // // // // // // //                 ? "bg-green-600"
// // // // // // // // //                 : "bg-gray-500 hover:bg-gray-600"
// // // // // // // // //             }`}
// // // // // // // // //           >
// // // // // // // // //             Layer {i + 1}
// // // // // // // // //           </button>
// // // // // // // // //         ))}
// // // // // // // // //       </div>

// // // // // // // // //       <div className="mb-4 text-gray-600">
// // // // // // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // // // // // //       </div>

// // // // // // // // //       {loading ? (
// // // // // // // // //         <p>Loading downline...</p>
// // // // // // // // //       ) : isTableView ? (
// // // // // // // // //         // ‚úÖ Table View
// // // // // // // // //         <div className="overflow-x-auto">
// // // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // // //             <thead className="bg-gray-100">
// // // // // // // // //               <tr>
// // // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // // //               </tr>
// // // // // // // // //             </thead>
// // // // // // // // //             <tbody>
// // // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // // //                 <tr key={node.orderId}>
// // // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // // //                       : "‚ùå Pending"}
// // // // // // // // //                   </td>
// // // // // // // // //                 </tr>
// // // // // // // // //               ))}
// // // // // // // // //             </tbody>
// // // // // // // // //           </table>
// // // // // // // // //         </div>
// // // // // // // // //       ) : (
// // // // // // // // //         // ‚úÖ Tree View
// // // // // // // // //         <div className="space-y-2">
// // // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // // //             <div
// // // // // // // // //               key={node.orderId}
// // // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // // //             >
// // // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // // //                 Layer: {node.depth}
// // // // // // // // //               </span>
// // // // // // // // //               <div className="text-xs mt-1">
// // // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // // //                   : "‚ùå Pending"}
// // // // // // // // //               </div>
// // // // // // // // //             </div>
// // // // // // // // //           ))}
// // // // // // // // //         </div>
// // // // // // // // //       )}
// // // // // // // // //     </div>
// // // // // // // // //   );
// // // // // // // // // }

// // // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // // import adminAPI from "../api/adminApi";
// // // // // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // // // // helper ‚Üí filter nodes by selected layer
// // // // // // // // function getNodesByLayer(tree, layer) {
// // // // // // // //   const result = [];
// // // // // // // //   function traverse(node) {
// // // // // // // //     if (node.depth === layer) result.push(node);
// // // // // // // //     if (node.children) node.children.forEach(traverse);
// // // // // // // //   }
// // // // // // // //   tree.forEach(traverse);
// // // // // // // //   return result;
// // // // // // // // }

// // // // // // // // export default function AdminDownline() {
// // // // // // // //   const [fullTree, setFullTree] = useState([]);
// // // // // // // //   const [visibleLayer, setVisibleLayer] = useState(1);
// // // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // // //   const [isTableView, setIsTableView] = useState(false);

// // // // // // // //   const fetchDownlineData = async () => {
// // // // // // // //     setLoading(true);
// // // // // // // //     try {
// // // // // // // //       const res = await adminAPI.getOrders();
// // // // // // // //       if (res.success && Array.isArray(res.data)) {
// // // // // // // //         // ‚úÖ Build ternary tree on frontend
// // // // // // // //         const tree = buildTernaryTree(res.data, [], 10);
// // // // // // // //         setFullTree(tree);
// // // // // // // //       } else {
// // // // // // // //         console.warn("Unexpected data format:", res);
// // // // // // // //       }
// // // // // // // //     } catch (err) {
// // // // // // // //       console.error("Error fetching downline:", err);
// // // // // // // //     } finally {
// // // // // // // //       setLoading(false);
// // // // // // // //     }
// // // // // // // //   };

// // // // // // // //   useEffect(() => {
// // // // // // // //     fetchDownlineData();
// // // // // // // //   }, []);

// // // // // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // // // // //   return (
// // // // // // // //     <div className="p-6">
// // // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // // // // //         <button
// // // // // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // // // // //         >
// // // // // // // //           {isTableView ? "Show Tree View" : "Show Table View"}
// // // // // // // //         </button>

// // // // // // // //         <button
// // // // // // // //           onClick={fetchDownlineData}
// // // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // // //         >
// // // // // // // //           üîÑ Refresh
// // // // // // // //         </button>

// // // // // // // //         {[...Array(10)].map((_, i) => (
// // // // // // // //           <button
// // // // // // // //             key={i}
// // // // // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // // // // //               visibleLayer === i + 1
// // // // // // // //                 ? "bg-green-600"
// // // // // // // //                 : "bg-gray-500 hover:bg-gray-600"
// // // // // // // //             }`}
// // // // // // // //           >
// // // // // // // //             Layer {i + 1}
// // // // // // // //           </button>
// // // // // // // //         ))}
// // // // // // // //       </div>

// // // // // // // //       <div className="mb-4 text-gray-600">
// // // // // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // // // // //       </div>

// // // // // // // //       {loading ? (
// // // // // // // //         <p>Loading downline...</p>
// // // // // // // //       ) : isTableView ? (
// // // // // // // //         // Table View
// // // // // // // //         <div className="overflow-x-auto">
// // // // // // // //           <table className="min-w-full border border-gray-200">
// // // // // // // //             <thead className="bg-gray-100">
// // // // // // // //               <tr>
// // // // // // // //                 <th className="px-4 py-2 border">User</th>
// // // // // // // //                 <th className="px-4 py-2 border">Layer</th>
// // // // // // // //                 <th className="px-4 py-2 border">Parent</th>
// // // // // // // //                 <th className="px-4 py-2 border">Payment</th>
// // // // // // // //               </tr>
// // // // // // // //             </thead>
// // // // // // // //             <tbody>
// // // // // // // //               {visibleNodes.map((node) => (
// // // // // // // //                 <tr key={node.orderId}>
// // // // // // // //                   <td className="px-4 py-2 border">{node.userId}</td>
// // // // // // // //                   <td className="px-4 py-2 border">{node.depth}</td>
// // // // // // // //                   <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // // // // //                   <td className="px-4 py-2 border">
// // // // // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // //                       ? "‚úÖ Paid"
// // // // // // // //                       : "‚ùå Pending"}
// // // // // // // //                   </td>
// // // // // // // //                 </tr>
// // // // // // // //               ))}
// // // // // // // //             </tbody>
// // // // // // // //           </table>
// // // // // // // //         </div>
// // // // // // // //       ) : (
// // // // // // // //         // Tree View
// // // // // // // //         <div className="space-y-2">
// // // // // // // //           {visibleNodes.map((node) => (
// // // // // // // //             <div
// // // // // // // //               key={node.orderId}
// // // // // // // //               style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // // // // //               className="p-2 rounded border bg-green-50"
// // // // // // // //             >
// // // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // // //                 Layer: {node.depth}
// // // // // // // //               </span>
// // // // // // // //               <div className="text-xs mt-1">
// // // // // // // //                 {["Paid", "Completed"].includes(node.paymentStatus)
// // // // // // // //                   ? "‚úÖ Paid"
// // // // // // // //                   : "‚ùå Pending"}
// // // // // // // //               </div>
// // // // // // // //             </div>
// // // // // // // //           ))}
// // // // // // // //         </div>
// // // // // // // //       )}
// // // // // // // //     </div>
// // // // // // // //   );
// // // // // // // // }



// // // // // // // import React, { useEffect, useState } from "react";
// // // // // // // import adminAPI from "../api/adminApi";

// // // // // // // // üß† Build tree from flat array where children = array of child IDs
// // // // // // // function buildTreeFromFlatData(orders) {
// // // // // // //   const map = new Map();
// // // // // // //   const roots = [];

// // // // // // //   // Initialize nodes
// // // // // // //   orders.forEach((o) => {
// // // // // // //     map.set(String(o._id), { ...o, children: [] });
// // // // // // //   });

// // // // // // //   // Connect parents and children
// // // // // // //   orders.forEach((o) => {
// // // // // // //     const parentId = String(o.parentId);
// // // // // // //     if (parentId && parentId !== String(o._id)) {
// // // // // // //       const parent = map.get(parentId);
// // // // // // //       if (parent) {
// // // // // // //         parent.children.push(map.get(String(o._id)));
// // // // // // //       } else {
// // // // // // //         roots.push(map.get(String(o._id)));
// // // // // // //       }
// // // // // // //     } else {
// // // // // // //       roots.push(map.get(String(o._id)));
// // // // // // //     }
// // // // // // //   });

// // // // // // //   return roots;
// // // // // // // }

// // // // // // // export default function AdminDownline() {
// // // // // // //   const [treeData, setTreeData] = useState([]);
// // // // // // //   const [loading, setLoading] = useState(false);
// // // // // // //   const [expandedNodes, setExpandedNodes] = useState(new Set());

// // // // // // //   const fetchDownlineData = async () => {
// // // // // // //     setLoading(true);
// // // // // // //     try {
// // // // // // //       const res = await adminAPI.getOrders();
// // // // // // //       if (res.success && Array.isArray(res.data)) {
// // // // // // //         const tree = buildTreeFromFlatData(res.data);
// // // // // // //         setTreeData(tree);
// // // // // // //       } else {
// // // // // // //         console.warn("Unexpected response:", res);
// // // // // // //       }
// // // // // // //     } catch (err) {
// // // // // // //       console.error("Error fetching downline:", err);
// // // // // // //     } finally {
// // // // // // //       setLoading(false);
// // // // // // //     }
// // // // // // //   };

// // // // // // //   useEffect(() => {
// // // // // // //     fetchDownlineData();
// // // // // // //   }, []);

// // // // // // //   // toggle expand/collapse for nodes
// // // // // // //   const toggleNode = (id) => {
// // // // // // //     setExpandedNodes((prev) => {
// // // // // // //       const newSet = new Set(prev);
// // // // // // //       if (newSet.has(id)) newSet.delete(id);
// // // // // // //       else newSet.add(id);
// // // // // // //       return newSet;
// // // // // // //     });
// // // // // // //   };

// // // // // // //   // recursive tree renderer
// // // // // // //   const renderTree = (nodes, level = 1) =>
// // // // // // //     nodes.map((node) => {
// // // // // // //       const isExpanded = expandedNodes.has(node._id);
// // // // // // //       const hasChildren = node.children.length > 0;

// // // // // // //       return (
// // // // // // //         <div key={node._id}>
// // // // // // //           <div
// // // // // // //             className="p-2 rounded border bg-green-50 flex items-center justify-between"
// // // // // // //             style={{ marginLeft: `${(level - 1) * 20}px` }}
// // // // // // //           >
// // // // // // //             <div>
// // // // // // //               {hasChildren && (
// // // // // // //                 <button
// // // // // // //                   onClick={() => toggleNode(node._id)}
// // // // // // //                   className="mr-2 font-bold"
// // // // // // //                 >
// // // // // // //                   {isExpanded ? "‚ñº" : "‚ñ∂"}
// // // // // // //                 </button>
// // // // // // //               )}
// // // // // // //               <span className="font-bold">{node.userId}</span>
// // // // // // //               <span className="text-sm text-gray-600 ml-2">
// // // // // // //                 Layer: {node.depth ?? level}
// // // // // // //                 {node.leg ? ` ‚Ä¢ Leg: ${node.leg}` : ""}
// // // // // // //               </span>
// // // // // // //             </div>

// // // // // // //             <div className="text-xs">
// // // // // // //               {node.paymentStatus === "Completed" ? "‚úÖ Paid" : "‚ùå Pending"}
// // // // // // //             </div>
// // // // // // //           </div>

// // // // // // //           {isExpanded && hasChildren && renderTree(node.children, level + 1)}
// // // // // // //         </div>
// // // // // // //       );
// // // // // // //     });

// // // // // // //   return (
// // // // // // //     <div className="p-6">
// // // // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network</h2>

// // // // // // //       <div className="flex gap-3 mb-6">
// // // // // // //         <button
// // // // // // //           onClick={fetchDownlineData}
// // // // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // // // //         >
// // // // // // //           üîÑ Refresh
// // // // // // //         </button>
// // // // // // //       </div>

// // // // // // //       {loading ? <p>Loading downline...</p> : renderTree(treeData)}
// // // // // // //     </div>
// // // // // // //   );
// // // // // // // }

// // // // // // src/pages/AdminDownline.jsx
// // // // // import React, { useEffect, useState } from "react";
// // // // // import adminAPI from "../api/adminApi";
// // // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // // // ‚úÖ helper: filter nodes by layer
// // // // // function getNodesByLayer(tree, layer) {
// // // // //   const result = [];
// // // // //   function traverse(node) {
// // // // //     if (node.depth === layer) result.push(node);
// // // // //     if (node.children) node.children.forEach(traverse);
// // // // //   }
// // // // //   tree.forEach(traverse);
// // // // //   return result;
// // // // // }

// // // // // export default function AdminDownline() {
// // // // //   const [fullTree, setFullTree] = useState([]);
// // // // //   const [visibleLayer, setVisibleLayer] = useState(1);
// // // // //   const [loading, setLoading] = useState(false);
// // // // //   const [isTableView, setIsTableView] = useState(false);
// // // // //   const [error, setError] = useState("");

// // // // //   // ‚úÖ Fetch Downline Data
// // // // //   const fetchDownlineData = async () => {
// // // // //     setLoading(true);
// // // // //     setError("");
// // // // //     try {
// // // // //       const res = await adminAPI.getOrders();
// // // // //       console.log("üì¶ Full API Response:", res);

// // // // //       if (!res || !res.success) {
// // // // //         setError("Invalid API response format or no success flag.");
// // // // //         console.warn("‚ö†Ô∏è Invalid API response:", res);
// // // // //         return;
// // // // //       }

// // // // //       if (!Array.isArray(res.data)) {
// // // // //         setError("API did not return an array in 'data'.");
// // // // //         console.warn("‚ö†Ô∏è Unexpected 'data' format:", res.data);
// // // // //         return;
// // // // //       }

// // // // //       console.log("‚úÖ API Raw Data:", res.data);

// // // // //       // ‚úÖ Build tree using your util
// // // // //       const tree = buildTernaryTree(res.data, [], 10);
// // // // //       console.log("üå≥ Built Tree Output:", tree);

// // // // //       setFullTree(tree);
// // // // //     } catch (err) {
// // // // //       console.error("‚ùå Error fetching downline data:", err);
// // // // //       setError(err.message || "Something went wrong while fetching data");
// // // // //     } finally {
// // // // //       setLoading(false);
// // // // //     }
// // // // //   };

// // // // //   useEffect(() => {
// // // // //     fetchDownlineData();
// // // // //   }, []);

// // // // //   // ‚úÖ Get nodes for current layer
// // // // //   const visibleNodes = getNodesByLayer(fullTree, visibleLayer);

// // // // //   return (
// // // // //     <div className="p-6">
// // // // //       <h2 className="text-2xl font-bold mb-4">üìä Downline Network (Debug Mode)</h2>

// // // // //       {/* Control Buttons */}
// // // // //       <div className="flex flex-wrap gap-3 mb-6">
// // // // //         <button
// // // // //           onClick={() => setIsTableView((p) => !p)}
// // // // //           className="px-4 py-2 rounded border bg-gray-100 hover:bg-gray-200"
// // // // //         >
// // // // //           {isTableView ? "Switch to Tree View" : "Switch to Table View"}
// // // // //         </button>

// // // // //         <button
// // // // //           onClick={fetchDownlineData}
// // // // //           className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
// // // // //         >
// // // // //           üîÑ Refresh
// // // // //         </button>

// // // // //         {/* Layer Buttons */}
// // // // //         {[...Array(10)].map((_, i) => (
// // // // //           <button
// // // // //             key={i}
// // // // //             onClick={() => setVisibleLayer(i + 1)}
// // // // //             className={`px-3 py-1 rounded text-white text-xs ${
// // // // //               visibleLayer === i + 1
// // // // //                 ? "bg-green-600"
// // // // //                 : "bg-gray-500 hover:bg-gray-600"
// // // // //             }`}
// // // // //           >
// // // // //             Layer {i + 1}
// // // // //           </button>
// // // // //         ))}
// // // // //       </div>

// // // // //       {/* Info / Error Display */}
// // // // //       {loading && <p className="text-blue-600">‚è≥ Loading downline data...</p>}
// // // // //       {error && (
// // // // //         <p className="text-red-600 bg-red-100 p-2 rounded">‚ö†Ô∏è {error}</p>
// // // // //       )}

// // // // //       <div className="mb-4 text-gray-600">
// // // // //         Showing Layer {visibleLayer} ‚Ä¢ Nodes: {visibleNodes.length}
// // // // //       </div>

// // // // //       {/* üß† Debug Logs (frontend-side) */}
// // // // //       <details className="mb-4 bg-gray-50 p-2 rounded text-xs">
// // // // //         <summary className="cursor-pointer font-semibold">Debug Info</summary>
// // // // //         <pre className="overflow-x-auto text-gray-700">
// // // // // {JSON.stringify(fullTree.slice(0, 5), null, 2)}
// // // // //         </pre>
// // // // //       </details>

// // // // //       {/* Render Data */}
// // // // //       {!loading && !error && (
// // // // //         <>
// // // // //           {isTableView ? (
// // // // //             // ‚úÖ Table View
// // // // //             <div className="overflow-x-auto">
// // // // //               <table className="min-w-full border border-gray-300">
// // // // //                 <thead className="bg-gray-100">
// // // // //                   <tr>
// // // // //                     <th className="px-4 py-2 border">User</th>
// // // // //                     <th className="px-4 py-2 border">Layer</th>
// // // // //                     <th className="px-4 py-2 border">Parent</th>
// // // // //                     <th className="px-4 py-2 border">Payment</th>
// // // // //                   </tr>
// // // // //                 </thead>
// // // // //                 <tbody>
// // // // //                   {visibleNodes.map((node) => (
// // // // //                     <tr key={node.orderId}>
// // // // //                       <td className="px-4 py-2 border">{node.userId}</td>
// // // // //                       <td className="px-4 py-2 border">{node.depth}</td>
// // // // //                       <td className="px-4 py-2 border">{node.parentId || "-"}</td>
// // // // //                       <td className="px-4 py-2 border">
// // // // //                         {["Paid", "Completed"].includes(node.paymentStatus)
// // // // //                           ? "‚úÖ Paid"
// // // // //                           : "‚ùå Pending"}
// // // // //                       </td>
// // // // //                     </tr>
// // // // //                   ))}
// // // // //                 </tbody>
// // // // //               </table>
// // // // //             </div>
// // // // //           ) : (
// // // // //             // ‚úÖ Tree View
// // // // //             <div className="space-y-2">
// // // // //               {visibleNodes.map((node) => (
// // // // //                 <div
// // // // //                   key={node.orderId}
// // // // //                   style={{ marginLeft: `${(node.depth - 1) * 20}px` }}
// // // // //                   className="p-2 rounded border bg-green-50"
// // // // //                 >
// // // // //                   <span className="font-bold">{node.userId}</span>
// // // // //                   <span className="text-sm text-gray-600 ml-2">
// // // // //                     Layer: {node.depth}
// // // // //                   </span>
// // // // //                   <div className="text-xs mt-1">
// // // // //                     {["Paid", "Completed"].includes(node.paymentStatus)
// // // // //                       ? "‚úÖ Paid"
// // // // //                       : "‚ùå Pending"}
// // // // //                   </div>
// // // // //                 </div>
// // // // //               ))}
// // // // //             </div>
// // // // //           )}
// // // // //         </>
// // // // //       )}
// // // // //     </div>
// // // // //   );
// // // // // }

// // // // import React, { useEffect, useState } from "react";
// // // // import adminAPI from "../api/adminApi";
// // // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // // export default function AdminDownline() {
// // // //   const [fullTree, setFullTree] = useState([]);
// // // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // // //   const [selectedLayer, setSelectedLayer] = useState(1);

// // // //   useEffect(() => {
// // // //     fetchData();
// // // //   }, []);

// // // //   const fetchData = async () => {
// // // //     try {
// // // //       const response = await adminAPI.getOrders();
// // // //       console.log("üì¶ Full API Response: ", response);

// // // //       const orders = response.data || [];
// // // //       console.log("‚úÖ API Raw Data: ", orders);

// // // //       const tree = buildTernaryTree(orders);
// // // //       console.log("üå≥ Built Tree Output: ", tree);

// // // //       setFullTree(tree);
// // // //       setFilteredNodes(filterByLayer(tree, 1)); // initially layer 1
// // // //     } catch (error) {
// // // //       console.error("‚ùå Error fetching data:", error);
// // // //     }
// // // //   };

// // // //   // Recursively filter nodes by depth
// // // //   const filterByLayer = (nodes, layer, currentDepth = 1) => {
// // // //     if (!nodes || nodes.length === 0) return [];
// // // //     if (currentDepth === layer) {
// // // //       // Return shallow copy of nodes (hide children)
// // // //       return nodes.map(n => ({ ...n, children: [] }));
// // // //     }
// // // //     return nodes
// // // //       .map(n => ({
// // // //         ...n,
// // // //         children: filterByLayer(n.children, layer, currentDepth + 1),
// // // //       }))
// // // //       .filter(Boolean);
// // // //   };

// // // //   const handleLayerChange = (layer) => {
// // // //     setSelectedLayer(layer);
// // // //     const filtered = filterByLayer(fullTree, layer);
// // // //     setFilteredNodes(filtered);
// // // //   };

// // // //   const renderNode = (node) => (
// // // //     <li key={node._id}>
// // // //       <strong>UserID:</strong> {node.userId} | <strong>Status:</strong> {node.paymentStatus}
// // // //       {node.children && node.children.length > 0 && (
// // // //         <ul>
// // // //           {node.children.map(child => renderNode(child))}
// // // //         </ul>
// // // //       )}
// // // //     </li>
// // // //   );

// // // //   return (
// // // //     <div>
// // // //       <h2>Admin Downline</h2>

// // // //       <div style={{ marginBottom: "10px" }}>
// // // //         <button onClick={() => handleLayerChange(1)}>Layer 1</button>
// // // //         <button onClick={() => handleLayerChange(2)}>Layer 2</button>
// // // //         <button onClick={() => handleLayerChange(3)}>Layer 3</button>
// // // //       </div>

// // // //       <ul>
// // // //         {filteredNodes.map(node => renderNode(node))}
// // // //       </ul>
// // // //     </div>
// // // //   );
// // // // }



// // // import React, { useEffect, useState } from "react";
// // // import adminAPI from "../api/adminApi";
// // // import { buildTernaryTree } from "../utils/treeBuilder";

// // // export default function AdminDownline() {
// // //   const [fullTree, setFullTree] = useState([]);
// // //   const [filteredNodes, setFilteredNodes] = useState([]);
// // //   const [selectedLayer, setSelectedLayer] = useState(1);
// // //   const [expandedNodes, setExpandedNodes] = useState({}); // Track expanded state

// // //   useEffect(() => {
// // //     fetchData();
// // //   }, []);

// // //   const fetchData = async () => {
// // //     try {
// // //       const response = await adminAPI.getOrders();
// // //       const orders = response.data || [];
// // //       const tree = buildTernaryTree(orders);

// // //       setFullTree(tree);
// // //       setFilteredNodes(filterByLayer(tree, 1));
// // //     } catch (error) {
// // //       console.error("‚ùå Error fetching data:", error);
// // //     }
// // //   };

// // //   // Filter nodes by layer (initial load)
// // //   const filterByLayer = (nodes, layer, currentDepth = 1) => {
// // //     if (!nodes || nodes.length === 0) return [];
// // //     if (currentDepth === layer) {
// // //       return nodes.map(n => ({ ...n, children: [] }));
// // //     }
// // //     return nodes
// // //       .map(n => ({
// // //         ...n,
// // //         children: filterByLayer(n.children, layer, currentDepth + 1),
// // //       }))
// // //       .filter(Boolean);
// // //   };

// // //   const handleLayerChange = (layer) => {
// // //     setSelectedLayer(layer);
// // //     setFilteredNodes(filterByLayer(fullTree, layer));
// // //     setExpandedNodes({}); // Reset expanded nodes when layer changes
// // //   };

// // //   // Toggle expand/collapse
// // //   const toggleNode = (id) => {
// // //     setExpandedNodes(prev => ({ ...prev, [id]: !prev[id] }));
// // //   };

// // //   // Recursive render with collapsible children
// // //   const renderNode = (node) => {
// // //     const isExpanded = expandedNodes[node._id] || false;

// // //     return (
// // //       <div
// // //         key={node._id}
// // //         style={{
// // //           border: "1px solid #ccc",
// // //           borderRadius: "8px",
// // //           padding: "10px",
// // //           margin: "5px 0",
// // //           background: "#f9f9f9",
// // //           boxShadow: "0px 1px 3px rgba(0,0,0,0.1)",
// // //         }}
// // //       >
// // //         <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
// // //           <div>
// // //             <strong>UserID:</strong> {node.userId} | <strong>Status:</strong>{" "}
// // //             <span style={{ color: node.paymentStatus === "Completed" ? "green" : "orange", fontWeight: "bold" }}>
// // //               {node.paymentStatus}
// // //             </span>
// // //           </div>
// // //           {node.children && node.children.length > 0 && (
// // //             <button
// // //               onClick={() => toggleNode(node._id)}
// // //               style={{
// // //                 padding: "4px 8px",
// // //                 border: "none",
// // //                 borderRadius: "4px",
// // //                 background: "#4f46e5",
// // //                 color: "#fff",
// // //                 cursor: "pointer",
// // //               }}
// // //             >
// // //               {isExpanded ? "Collapse" : "Expand"}
// // //             </button>
// // //           )}
// // //         </div>

// // //         {isExpanded && node.children && node.children.length > 0 && (
// // //           <div style={{ paddingLeft: "20px", marginTop: "5px" }}>
// // //             {node.children.map(child => renderNode(child))}
// // //           </div>
// // //         )}
// // //       </div>
// // //     );
// // //   };

// // //   return (
// // //     <div style={{ maxWidth: "900px", margin: "20px auto", fontFamily: "Arial, sans-serif" }}>
// // //       <h2 style={{ textAlign: "center", marginBottom: "20px" }}>Admin Downline</h2>

// // //       <div style={{ display: "flex", justifyContent: "center", gap: "10px", marginBottom: "20px" }}>
// // //         {[1, 2, 3].map(layer => (
// // //           <button
// // //             key={layer}
// // //             onClick={() => handleLayerChange(layer)}
// // //             style={{
// // //               padding: "8px 16px",
// // //               borderRadius: "6px",
// // //               border: "none",
// // //               cursor: "pointer",
// // //               background: selectedLayer === layer ? "#4f46e5" : "#e0e0e0",
// // //               color: selectedLayer === layer ? "#fff" : "#000",
// // //               fontWeight: "bold",
// // //             }}
// // //           >
// // //             Layer {layer}
// // //           </button>
// // //         ))}
// // //       </div>

// // //       <div>{filteredNodes.map(node => renderNode(node))}</div>
// // //     </div>
// // //   );
// // // }


// // import React, { useEffect, useState } from "react";
// // import adminAPI from "../api/adminApi";
// // import { buildTernaryTree } from "../utils/treeBuilder";

// // export default function AdminDownline() {
// //   const [fullTree, setFullTree] = useState([]);
// //   const [filteredNodes, setFilteredNodes] = useState([]);
// //   const [selectedLayer, setSelectedLayer] = useState(1);
// //   const [expandedNodes, setExpandedNodes] = useState({});

// //   useEffect(() => {
// //     fetchData();
// //   }, []);

// //   const fetchData = async () => {
// //     try {
// //       const response = await adminAPI.getOrders();
// //       const orders = response.data || [];
// //       const tree = buildTernaryTree(orders);

// //       setFullTree(tree);
// //       setFilteredNodes(filterByLayer(tree, 1));
// //     } catch (error) {
// //       console.error("‚ùå Error fetching data:", error);
// //     }
// //   };

// //   const filterByLayer = (nodes, layer, currentDepth = 1) => {
// //     if (!nodes || nodes.length === 0) return [];
// //     if (currentDepth === layer) return nodes.map(n => ({ ...n, children: [] }));
// //     return nodes
// //       .map(n => ({
// //         ...n,
// //         children: filterByLayer(n.children, layer, currentDepth + 1),
// //       }))
// //       .filter(Boolean);
// //   };

// //   const handleLayerChange = (layer) => {
// //     setSelectedLayer(layer);
// //     setFilteredNodes(filterByLayer(fullTree, layer));
// //     setExpandedNodes({});
// //   };

// //   const toggleNode = (id) => {
// //     setExpandedNodes(prev => ({ ...prev, [id]: !prev[id] }));
// //   };

// //   const renderNode = (node) => {
// //     const isExpanded = expandedNodes[node._id] || false;

// //     return (
// //       <div
// //         key={node._id}
// //         style={{
// //           border: "1px solid #ccc",
// //           borderRadius: "8px",
// //           padding: "10px",
// //           margin: "5px 0",
// //           background: "#f9f9f9",
// //           boxShadow: "0px 1px 3px rgba(0,0,0,0.1)",
// //         }}
// //       >
// //         <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
// //           <div>
// //             <strong>UserID:</strong> {node.userId} |{" "}
// //             <strong>Status:</strong>{" "}
// //             <span style={{ color: node.paymentStatus === "Completed" ? "green" : "orange", fontWeight: "bold" }}>
// //               {node.paymentStatus}
// //             </span>
// //           </div>
// //           {node.children && node.children.length > 0 && (
// //             <button
// //               onClick={() => toggleNode(node._id)}
// //               style={{
// //                 padding: "4px 8px",
// //                 border: "none",
// //                 borderRadius: "4px",
// //                 background: "#4f46e5",
// //                 color: "#fff",
// //                 cursor: "pointer",
// //               }}
// //             >
// //               {isExpanded ? "Collapse" : "Expand"}
// //             </button>
// //           )}
// //         </div>

// //         {/* Animated children */}
// //         <div
// //           style={{
// //             maxHeight: isExpanded ? "1000px" : "0px",
// //             overflow: "hidden",
// //             transition: "all 0.3s ease",
// //             paddingLeft: isExpanded ? "20px" : "0px",
// //             marginTop: isExpanded ? "5px" : "0px",
// //           }}
// //         >
// //           {isExpanded &&
// //             node.children &&
// //             node.children.map(child => renderNode(child))}
// //         </div>
// //       </div>
// //     );
// //   };

// //   return (
// //     <div style={{ maxWidth: "900px", margin: "20px auto", fontFamily: "Arial, sans-serif" }}>
// //       <h2 style={{ textAlign: "center", marginBottom: "20px" }}>Admin Downline</h2>

// //       <div style={{ display: "flex", justifyContent: "center", gap: "10px", marginBottom: "20px" }}>
// //         {[1, 2, 3].map(layer => (
// //           <button
// //             key={layer}
// //             onClick={() => handleLayerChange(layer)}
// //             style={{
// //               padding: "8px 16px",
// //               borderRadius: "6px",
// //               border: "none",
// //               cursor: "pointer",
// //               background: selectedLayer === layer ? "#4f46e5" : "#e0e0e0",
// //               color: selectedLayer === layer ? "#fff" : "#000",
// //               fontWeight: "bold",
// //             }}
// //           >
// //             Layer {layer}
// //           </button>
// //         ))}
// //       </div>

// //       <div>{filteredNodes.map(node => renderNode(node))}</div>
// //     </div>
// //   );
// // }


// import React, { useEffect, useState } from "react";
// import { motion, AnimatePresence } from "framer-motion";
// import adminAPI from "../api/adminApi";
// import { buildTernaryTree } from "../utils/treeBuilder";

// export default function AdminDownline() {
//   const [fullTree, setFullTree] = useState([]);
//   const [filteredNodes, setFilteredNodes] = useState([]);
//   const [selectedLayer, setSelectedLayer] = useState(1);
//   const [expandedNodes, setExpandedNodes] = useState({});

//   useEffect(() => {
//     fetchData();
//   }, []);

//   const fetchData = async () => {
//     try {
//       const response = await adminAPI.getOrders();
//       const orders = response.data || [];
//       const tree = buildTernaryTree(orders);

//       setFullTree(tree);
//       setFilteredNodes(filterByLayer(tree, 1));
//     } catch (error) {
//       console.error("‚ùå Error fetching data:", error);
//     }
//   };

//   const filterByLayer = (nodes, layer, currentDepth = 1) => {
//     if (!nodes || nodes.length === 0) return [];
//     if (currentDepth === layer) return nodes.map(n => ({ ...n, children: [] }));
//     return nodes
//       .map(n => ({
//         ...n,
//         children: filterByLayer(n.children, layer, currentDepth + 1),
//       }))
//       .filter(Boolean);
//   };

//   const handleLayerChange = (layer) => {
//     setSelectedLayer(layer);
//     setFilteredNodes(filterByLayer(fullTree, layer));
//     setExpandedNodes({});
//   };

//   const toggleNode = (id) => {
//     setExpandedNodes(prev => ({ ...prev, [id]: !prev[id] }));
//   };

//   const renderNode = (node) => {
//     const isExpanded = expandedNodes[node._id] || false;

//     return (
//       <motion.div
//         key={node._id}
//         layout
//         initial={{ opacity: 0, scale: 0.95 }}
//         animate={{ opacity: 1, scale: 1 }}
//         exit={{ opacity: 0, scale: 0.95 }}
//         style={{
//           border: "1px solid #ccc",
//           borderRadius: "8px",
//           padding: "10px",
//           margin: "8px 0",
//           background: "#f9f9f9",
//           boxShadow: "0px 1px 3px rgba(0,0,0,0.1)",
//         }}
//       >
//         <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
//           <div>
//             <strong>UserID:</strong> {node.userId} |{" "}
//             <strong>Status:</strong>{" "}
//             <span style={{ color: node.paymentStatus === "Completed" ? "green" : "orange", fontWeight: "bold" }}>
//               {node.paymentStatus}
//             </span>
//           </div>
//           {node.children && node.children.length > 0 && (
//             <button
//               onClick={() => toggleNode(node._id)}
//               style={{
//                 padding: "4px 8px",
//                 border: "none",
//                 borderRadius: "4px",
//                 background: "#4f46e5",
//                 color: "#fff",
//                 cursor: "pointer",
//               }}
//             >
//               {isExpanded ? "Collapse" : "Expand"}
//             </button>
//           )}
//         </div>

//         <AnimatePresence>
//           {isExpanded && node.children && node.children.length > 0 && (
//             <motion.div
//               key="children"
//               initial={{ height: 0, opacity: 0 }}
//               animate={{ height: "auto", opacity: 1 }}
//               exit={{ height: 0, opacity: 0 }}
//               transition={{ duration: 0.3 }}
//               style={{ overflow: "hidden", paddingLeft: "20px", marginTop: "5px" }}
//             >
//               {node.children.map(child => renderNode(child))}
//             </motion.div>
//           )}
//         </AnimatePresence>
//       </motion.div>
//     );
//   };

//   return (
//     <div style={{ maxWidth: "900px", margin: "20px auto", fontFamily: "Arial, sans-serif" }}>
//       <h2 style={{ textAlign: "center", marginBottom: "20px" }}>Admin Downline</h2>

//       <div style={{ display: "flex", justifyContent: "center", gap: "10px", marginBottom: "20px" }}>
//         {[1, 2, 3].map(layer => (
//           <button
//             key={layer}
//             onClick={() => handleLayerChange(layer)}
//             style={{
//               padding: "8px 16px",
//               borderRadius: "6px",
//               border: "none",
//               cursor: "pointer",
//               background: selectedLayer === layer ? "#4f46e5" : "#e0e0e0",
//               color: selectedLayer === layer ? "#fff" : "#000",
//               fontWeight: "bold",
//             }}
//           >
//             Layer {layer}
//           </button>
//         ))}
//       </div>

//       <div>
//         <AnimatePresence>
//           {filteredNodes.map(node => renderNode(node))}
//         </AnimatePresence>
//       </div>
//     </div>
//   );
// }



import React, { useEffect, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import adminAPI from "../api/adminApi";
import { buildTernaryTree } from "../utils/treeBuilder";

export default function AdminDownline() {
  const [fullTree, setFullTree] = useState([]);
  const [filteredNodes, setFilteredNodes] = useState([]);
  const [selectedLayer, setSelectedLayer] = useState(1);
  const [expandedNodes, setExpandedNodes] = useState({});

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      const response = await adminAPI.getOrders();
      const orders = response.data || [];
      const tree = buildTernaryTree(orders, 10); // maxDepth 10
      setFullTree(tree);
      setFilteredNodes(filterByLayer(tree, 1));
    } catch (error) {
      console.error("‚ùå Error fetching data:", error);
    }
  };

  // Recursively filter nodes by depth
  const filterByLayer = (nodes, layer, currentDepth = 1) => {
    if (!nodes || nodes.length === 0) return [];
    if (currentDepth === layer) {
      // shallow copy of nodes, hide children
      return nodes.map(n => ({ ...n, children: [] }));
    }
    return nodes
      .map(n => ({
        ...n,
        children: filterByLayer(n.children, layer, currentDepth + 1),
      }))
      .filter(Boolean);
  };

  const handleLayerChange = layer => {
    setSelectedLayer(layer);
    setFilteredNodes(filterByLayer(fullTree, layer));
    setExpandedNodes({});
  };

  const toggleNode = id => {
    setExpandedNodes(prev => ({ ...prev, [id]: !prev[id] }));
  };

  const expandCollapseAll = (expand = true) => {
    const updated = {};
    const traverse = nodes => {
      nodes.forEach(n => {
        if (expand) updated[n._id] = true;
        traverse(n.children || []);
      });
    };
    traverse(filteredNodes);
    setExpandedNodes(updated);
  };

  const renderNode = node => {
    const isExpanded = expandedNodes[node._id] || false;

    return (
      <motion.div
        key={node._id}
        layout
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        exit={{ opacity: 0, scale: 0.95 }}
        style={{
          border: "1px solid #ccc",
          borderRadius: "8px",
          padding: "10px",
          margin: "8px 0",
          background: "#f9f9f9",
          boxShadow: "0px 1px 3px rgba(0,0,0,0.1)",
        }}
      >
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
          <div>
            <strong>UserID:</strong> {node.userId} |{" "}
            <strong>Status:</strong>{" "}
            <span
              style={{
                color: node.paymentStatus === "Completed" ? "green" : "orange",
                fontWeight: "bold",
              }}
            >
              {node.paymentStatus}
            </span>{" "}
            | <strong>Depth:</strong> {node.depth} | <strong>Leg:</strong> {node.leg || "-"}
          </div>

          {node.children && node.children.length > 0 && (
            <button
              onClick={() => toggleNode(node._id)}
              style={{
                padding: "4px 8px",
                border: "none",
                borderRadius: "4px",
                background: "#4f46e5",
                color: "#fff",
                cursor: "pointer",
              }}
            >
              {isExpanded ? "Collapse" : "Expand"}
            </button>
          )}
        </div>

        <AnimatePresence>
          {isExpanded && node.children && node.children.length > 0 && (
            <motion.div
              key="children"
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              transition={{ duration: 0.3 }}
              style={{ overflow: "hidden", paddingLeft: "20px", marginTop: "5px" }}
            >
              {node.children.map(child => renderNode(child))}
            </motion.div>
          )}
        </AnimatePresence>
      </motion.div>
    );
  };

  return (
    <div style={{ maxWidth: "1000px", margin: "20px auto", fontFamily: "Arial, sans-serif" }}>
      <h2 style={{ textAlign: "center", marginBottom: "20px" }}>Admin Downline</h2>

      <div
        style={{
          display: "flex",
          justifyContent: "center",
          flexWrap: "wrap",
          gap: "10px",
          marginBottom: "20px",
        }}
      >
        {[...Array(10).keys()].map(i => {
          const layer = i + 1;
          return (
            <button
              key={layer}
              onClick={() => handleLayerChange(layer)}
              style={{
                padding: "8px 16px",
                borderRadius: "6px",
                border: "none",
                cursor: "pointer",
                background: selectedLayer === layer ? "#4f46e5" : "#e0e0e0",
                color: selectedLayer === layer ? "#fff" : "#000",
                fontWeight: "bold",
              }}
            >
              Layer {layer}
            </button>
          );
        })}
      </div>

      <div style={{ display: "flex", justifyContent: "center", gap: "10px", marginBottom: "15px" }}>
        <button
          onClick={() => expandCollapseAll(true)}
          style={{
            padding: "6px 12px",
            borderRadius: "6px",
            border: "none",
            background: "green",
            color: "#fff",
            cursor: "pointer",
            fontWeight: "bold",
          }}
        >
          Expand All
        </button>
        <button
          onClick={() => expandCollapseAll(false)}
          style={{
            padding: "6px 12px",
            borderRadius: "6px",
            border: "none",
            background: "red",
            color: "#fff",
            cursor: "pointer",
            fontWeight: "bold",
          }}
        >
          Collapse All
        </button>
      </div>

      <div>
        <AnimatePresence>
          {filteredNodes.map(node => renderNode(node))}
        </AnimatePresence>
      </div>
    </div>
  );
}
